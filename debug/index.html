<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./debug/leaflet.css" />
    <script src="./debug/leaflet-src.js"></script>
    <script src="../dist/gl-edit.dev.js"></script>
    <style>
        html, body{
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
            overflow: hidden;
        }

        #mapid{
            width: 100%;
            height: 100%;
        }

        ul{
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 0;
            background-color: aliceblue;
            display: flex;
            z-index: 1000;
        }

        li{
            padding: 10px 30px;
            list-style: none;
        }
    </style>
</head>
<body>
    <div id="mapid"></div>
    <ul>
        <li id="point">
            点
        </li>
        <li id="line">
            线
        </li>
        <li id="polygon">
            面
        </li>
    </ul>
    <script>
        window.process = {
            browser: true
        }
        var mymap = L.map('mapid', {
            updateWhenIdle: true
        }).setView([40.242846824049785, 116.72218322753908], 11);
        var tileLayer = L.tileLayer('https://t1.tianditu.gov.cn/DataServer?T=img_w&x={x}&y={y}&l={z}&tk=2db0ba5b3fa4414b2ea0ac2903d7519c');
        mymap.addLayer(tileLayer);

        var drawEditLayer = glEdit();
        mymap.addLayer(drawEditLayer);

        // 拾取事件
        drawEditLayer.on('picked:mousemove', (evt) => {
            console.log(evt, evt.feature.getId());
        });

        // 绘制完成事件
        drawEditLayer.on('finish', (evt) => {
            console.log(evt, evt.feature.getId());
        });

        const point = document.getElementById('point');
        point.onclick = function pointClick() {
            // 开始绘制
            drawEditLayer.start('point');
        };

        const line = document.getElementById('line');
        line.onclick = function lineClick() {
            // 开始绘制
            drawEditLayer.start('line');
        };

        const polygon = document.getElementById('polygon');
        polygon.onclick = function polygonClick() {
            // 开始绘制
            drawEditLayer.start('polygon', ({ id, lngLats }) => {
                console.log(id, lngLats);
            });

           
        };

        const lngMin = 115.84327697753908;
        const lngMax = 116.72218322753908;
        const latMin = 39.939224840791965;
        const latMax = 40.242846824049785;

        const lngStep = (116.72218322753908 - 115.84327697753908)/300;
        const latStep = (40.242846824049785 - 39.939224840791965)/300;

        const polygons = [];

        for (let g = 0; g < 10; g++) {
            for (let t = 0; t < 10; t++) {
                const lt = { lng:lngMin + g*lngStep, lat:latMax - t*latStep };
                const rt = { lng:lngMin + (g+1)*lngStep, lat:latMax - t*latStep };
                const rb = { lng:lngMin + (g+1)*lngStep, lat:latMax - (t+1)*latStep };
                const lb = { lng:lngMin + g*lngStep, lat:latMax - (t+1)*latStep };

                const info = { id: g + '_' + t, lngLats: [lt, rt, rb, lb, lt]};
                polygons.push(info);
            }
        }

        drawEditLayer.on('load', () => {
            drawEditLayer.render({
                polygon:polygons
            });

            // mymap.on('moveend', () => {
            //     drawEditLayer.render({
            //         polygon:polygons
            //     }); 
            // });
        });

        // setTimeout(() => {
        //     const lines = [], lngStep = 10;
        //     for (let g = 0; g < 10; g++) {
        //         for (let t = 0; t < 10; t++) {
        //             const lt = { lng:lngMin + g*lngStep, lat:latMax - t*latStep };
        //             const rt = { lng:lngMin + (g+1)*lngStep, lat:latMax - t*latStep };
        //             const rb = { lng:lngMin + (g+1)*lngStep, lat:latMax - (t+1)*latStep };
        //             const lb = { lng:lngMin + g*lngStep, lat:latMax - (t+1)*latStep };

        //             const info = { id: '0', lngLats: [lt, rt, rb, lb], style: { width:3, color: [255, 0, 0, 120] }};
        //             lines.push(info);
        //         }
        //     }
        //     drawEditLayer.render({
        //         line:lines
        //     });
        // }, 5000);
    </script>
    <!-- <script>
        (function(){var script=document.createElement('script');script.onload=function(){var stats=new Stats();document.body.appendChild(stats.dom);requestAnimationFrame(function loop(){stats.update();requestAnimationFrame(loop)});};script.src='//mrdoob.github.io/stats.js/build/stats.min.js';document.head.appendChild(script);})()
    </script> -->
</body>
</html>