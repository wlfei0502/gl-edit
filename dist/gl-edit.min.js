!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("leaflet"),require("regl")):"function"==typeof define&&define.amd?define(["leaflet","regl"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).glEdit=e(t.L,t.regl)}(this,function(t,e){"use strict";function n(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var r=n(t),i=n(e),o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var f=function(){return(f=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},u={lineMesh:function(e,n,r){for(let t=0;t<n-1;t++){var i=r+2*t,o=i+1,a=i+2,s=i+3;e.push(i,o,a,a,o,s)}return e}},c={duplicate:function(n,r,i){null==r&&(r=1),null==i&&(i=1);var o=[];const a=new Array(2*r);for(let t=0,e=n.length/r;t<e;t++){var s=t*r;for(let t=0;t<r;t++){var u=n[s+t];a[t]=u,a[t+r]=u*i}Array.prototype.push.apply(o,a)}return o},mapElement:function(n,r,i,o){for(let t=0,e=n.length/i;t<e;t++){var a=r+t*i;n[a]=o(n[a],a,t)}return n},pushElement:function(e,t,n){const r=new Array(n);var i=t*n;for(let t=0;t<n;t++)r[t]=e[i+t];return Array.prototype.push.apply(e,r),e},unshiftElement:function(e,t,n){const r=new Array(n);var i=t*n;for(let t=0;t<n;t++)r[t]=e[i+t];return Array.prototype.unshift.apply(e,r),e}};function s(t){return((t=t).trim?t.trim():t.replace(/^\s+|\s+$/g,"")).split(/\s+/)}function l(e,n,r){if(0<~(r=Array.isArray(r)?r:[]).indexOf(n))return n;r.push(n);var t=h(e),i=h(n);if(!t||!i)return function(e,n){var t=h(e),r=h(n);if(!t)return n;if(!r)return e;let i=[...Object.keys(n),...Object.getOwnPropertySymbols(n)];return i.forEach(function(t){e[t]=n[t]}),e}(e,n);let o=[...Object.keys(n),...Object.getOwnPropertySymbols(n)];return o.forEach(function(t){e[t]=l(e[t],n[t],r)}),e}function h(t){return!(!t||"[object Object]"!==Object.prototype.toString.call(t))}function p(e,n=[]){if(null===e||"object"!=typeof e)return e;var t,t=(t=t=>t.original===e,n.filter(t)[0]);if(t)return t.copy;const r=Array.isArray(e)?[]:{};return n.push({original:e,copy:r}),Object.keys(e).forEach(t=>{r[t]=p(e[t],n)}),r}function v(){return!1}var A,d,y=(x.prototype.on=function(t,e,n){if("object"==typeof t)for(var r in t)this._on(r,t[r],e);else for(var i=0,o=(t=s(t)).length;i<o;i++)this._on(t[i],e,n);return this},x.prototype.off=function(t,e,n){if(t)if("object"==typeof t)for(var r in t)this._off(r,t[r],e);else for(var i=0,o=(t=s(t)).length;i<o;i++)this._off(t[i],e,n);else delete this._events;return this},x.prototype._on=function(t,e,n){this._events=this._events||{};var r=this._events[t];r||(r=[],this._events[t]=r);for(var t={fn:e,ctx:n=n||this},i=r,o=0,a=i.length;o<a;o++)if(i[o].fn===e&&i[o].ctx===n)return;i.push(t)},x.prototype._off=function(t,e,n){var r,i,o;if(this._events&&(r=this._events[t]))if(e){if(n=n||this,r)for(i=0,o=r.length;i<o;i++){var a=r[i];if(a.ctx===n&&a.fn===e)return a.fn=v,this._firingCount&&(this._events[t]=r=r.slice()),void r.splice(i,1)}}else{for(i=0,o=r.length;i<o;i++)r[i].fn=v;delete this._events[t]}},x.prototype.fire=function(t,e){if(!this.listens(t))return this;if(this._events){var n=this._events[t];if(n){this._firingCount=this._firingCount+1||1;for(var r=0,i=n.length;r<i;r++){var o=n[r];o.fn.call(o.ctx||this,e)}this._firingCount--}}return this},x.prototype.listens=function(t){t=this._events&&this._events[t];return!(!t||!t.length)},x);function x(){this._events={},this._firingCount=0,this._events={}}(z=A=A||{}).POLYGON="polygon",z.BORDER="border",z.LINE="line",z.NODE="node",z.POINT="point",(V=d=d||{}).IDLE="idle",V.WATING="waiting",V.EDITING="editing",V.END="end",V.POINT_SELECT="point_select",V.LINE_SELECT="line_select",V.POLYGON_SELECT="polygon_select",V.NODE_SELECT="node_select";var g,t="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAeklEQVR4AWMgAvABcQEQFwGxEgMVQNq6desKV69eXQIxlHLQ8P//fzAGsQeHgaMGOiAZ6ECMBiVocmhAw7gMcMCuFpFOi9avX18McQUmRjcNlzqQGbB0WgBKuJQaCDIDZBYsa6VR6mWoGXwkR8qwS4ejBlJewFJeBQAAqLzY76D65MUAAAAASUVORK5CYII=",e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAABG0lEQVR4AbWTMWi0QBBG/+LA/hrZ5u/PHvu+Lw6s7QkBk85Nawqxuz6SUsukr84eu5QBSXoCImazDxS8DZG4Sz54MIzjY53Ff38VNXHWHDU7ZyFpmkZFUaQ8z3vVvRvN3lZ4Rjan6zolpVRCiA/97KQ5bBUeOZmZvu9VWZYqDMNPPfO0RbjjMznZT5l2vCm3aZqagiVyq3DPzvjMhdA5J3ZmCP9rYo1chRlmjRy4AEMY13V9rVtyDWYm6bc8Gzu7eHEYhrssyx6Bevnst3u+kPm+/z5fFDU9ayGnQpTneQnU9KyFRVE8mEJ61kIQQrwhAmqnHUKSJPUspHYWjuMogyB4AWpnIbRtew/UNsK4qqorXliDGWZXTTa/3hfS9r3bdRtDEgAAAABJRU5ErkJggg==",m={waiting:t,editing:t,point:e,node:e,line:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAABCElEQVR4AbWTAWbGQBCFi0hIBAIECkAukLOEAGEPUEULZE8RAaUEQAJoe4PkHiUHaFsWOp3HLrGVrv3X/3hWJuMz85K9uZZIe2U37CgYCG3bRm3bUpIk71x7YBeXAlfAjPZ9JykllWX5ze9GduULbDCZLaUUTdNEdV3/cM+LDzDCmpjsTDpjLz32fX8E2Ja+wAKZYc0DMFgjMrOAt2zBlg4L9NrACh/AAoplWe65JP8zejT0j16tzE4hXde9ZVn2iRPPzpxdwDRNv4gFaDBwGIbnOI4VoMETAoapnlim5gl0w7yBWAvrYU0DCwLq4AlQAwieMM/zD5yhQDHP853rx0YPet04z6v3C3dEyAkWQDzRAAAAAElFTkSuQmCC",polygon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAA0klEQVR4Ae2TMQ6CQBBFLUjo6WjsuQBnIaHeAxgL7ZhjcABqKPUIcA8TbmBC4zjfYNQxuI5EK3/ymnF82f0bFt8Kj7RCJgSzhUjXdZznOYdheJDZRog+FbaQXdP3PRMRx3F8lN9KIbEKM5xMZxgGrqqK0zQ9yc7OIgxwTZxsKmPHpmyLongQKMgqjNAZrnkTzk+JzpRwKTiBPLjLrkqCB1BC1zTNWkb0CuyM0qfsVWeTEs27Pes/8T2zhEqgZn/hrx/Fg03o6rpe+WTYwa7HZf/0zi/2zDOd9wpPAAAAAElFTkSuQmCC"},w=(a(b,g=y),b.prototype.enter=function(t){this.mode=t},b.prototype.exit=function(){this.mode=d.IDLE},b.prototype.hover=function(t,e){t=m[t];t?(this.isHover=e,this.gl.canvas.style.cursor="url("+t+") 9 9,auto"):this.gl.canvas.style.cursor="inherit"},b.prototype.out=function(){this.isHover&&(this.isHover=!1,this.gl.canvas.style.cursor="inherit")},b);function b(t){var e=t.gl,t=g.call(this)||this;return t.mode=d.IDLE,t.isHover=!1,t.gl=e,t}var B=Float32Array.BYTES_PER_ELEMENT;function E(t){var e={model:t.prop("modelMatrix"),color:t.prop("color")||[255,255,255,255],thickness:t.prop("width")||3,miter:1,aspect:function(t){return t.viewportWidth/t.viewportHeight},height:function(t){return t.viewportHeight/t.pixelRatio}},n={prevPosition:{buffer:t.prop("positionBuffer"),offset:0},currPosition:{buffer:t.prop("positionBuffer"),offset:2*B*2},nextPosition:{buffer:t.prop("positionBuffer"),offset:2*B*4},offsetScale:t.prop("offsetBuffer")};return t({vert:"#define GLSLIFY 1\nuniform mat3 model;uniform float thickness;uniform int miter;uniform float aspect;uniform float height;attribute vec2 prevPosition;attribute vec2 currPosition;attribute vec2 nextPosition;attribute float offsetScale;void main(){vec2 aspectVec=vec2(aspect,1.0);vec2 prevProject=(model*vec3(prevPosition,1.0)).xy;vec2 currProject=(model*vec3(currPosition,1.0)).xy;vec2 nextProject=(model*vec3(nextPosition,1.0)).xy;vec2 prevScreen=prevProject*aspectVec;vec2 currScreen=currProject*aspectVec;vec2 nextScreen=nextProject*aspectVec;float len=thickness;vec2 dir=vec2(0.0);if(currScreen==prevScreen){dir=normalize(nextScreen-currScreen);}else if(currScreen==nextScreen){dir=normalize(currScreen-prevScreen);}else{vec2 dirA=normalize((currScreen-prevScreen));if(miter==1){vec2 dirB=normalize((nextScreen-currScreen));float cosin=dot(dirA,dirB);if(cosin<-0.995){dir=dirB;}else{vec2 tangent=normalize(dirA+dirB);vec2 perp=vec2(-dirA.y,dirA.x);vec2 miter=vec2(-tangent.y,tangent.x);dir=tangent;len=thickness/dot(miter,perp);}}else{dir=dirA;}}vec2 normal=vec2(-dir.y,dir.x)*len;normal.y/=height;normal.x/=height*aspect/2.0;normal.x/=aspect;vec4 offset=vec4(normal*offsetScale,0.0,0.0);gl_Position=vec4(currProject,0.0,1.0)+offset;}",frag:"precision mediump float;\n#define GLSLIFY 1\nuniform vec4 color;void main(){gl_FragColor=color/255.0;}",uniforms:e,attributes:n,elements:t.prop("elements")})}var L=((z={})[A.POLYGON]=function(t){var e={model:t.prop("modelMatrix"),color:t.prop("color")||[255,0,102,127]},n={aPosition:{buffer:t.prop("positionBuffer"),offset:0}};return t({vert:"#define GLSLIFY 1\nuniform mat3 model;attribute vec2 aPosition;void main(){vec3 position=model*vec3(aPosition,1.0);gl_Position=vec4(position.xy,0.0,1.0);}",frag:"precision mediump float;\n#define GLSLIFY 1\nuniform vec4 color;void main(){gl_FragColor=color/255.0;}",uniforms:e,attributes:n,elements:t.prop("elements")})},z[A.BORDER]=E,z[A.LINE]=E,z[A.POINT]=function(t){var e={model:t.prop("modelMatrix"),texture:t.prop("texture"),color:t.prop("color"),fbo:t.prop("fbo")},n={aPosition:{buffer:t.prop("positionBuffer")},aTexCoord:{buffer:t.prop("texCoordBuffer")}};return t({vert:"#define GLSLIFY 1\nuniform mat3 model;attribute vec2 aPosition;attribute vec2 aTexCoord;varying vec2 uv;void main(){vec3 position=model*vec3(aPosition,1.0);gl_Position=vec4(position.xy,0.0,1.0);uv=aTexCoord;}",frag:"precision mediump float;\n#define GLSLIFY 1\nuniform sampler2D texture;uniform bool fbo;uniform vec4 color;varying vec2 uv;void main(){if(fbo){gl_FragColor=color/255.0;}else{gl_FragColor=texture2D(texture,uv);}}",uniforms:e,attributes:n,elements:t.prop("elements")})},z[A.NODE]=function(t){var e={model:t.prop("modelMatrix"),color:t.prop("color"),size:t.prop("size")},n={aPosition:{buffer:t.prop("positionBuffer"),offset:0}};return t({vert:"#define GLSLIFY 1\nuniform mat3 model;uniform float size;attribute vec2 aPosition;void main(){vec3 position=model*vec3(aPosition,1.0);gl_Position=vec4(position.xy,0.0,1.0);gl_PointSize=size;}",frag:"precision mediump float;\n#define GLSLIFY 1\nuniform vec4 color;void main(){float dist=distance(gl_PointCoord,vec2(0.5,0.5));float smooth1=smoothstep(0.55,0.45,dist);float smooth2=smoothstep(0.45,0.4,dist);gl_FragColor=vec4(0,0,0,1)*smooth1*(1.0-smooth2)+color/255.0*smooth2;}",uniforms:e,attributes:n,primitive:"points",count:1})},z);function M(t){var e={exports:{}};return t(e,e.exports),e.exports}var Q=M(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.setMatrixArrayType=function(t){e.ARRAY_TYPE=r=t},e.toRadian=function(t){return t*o},e.equals=function(t,e){return Math.abs(t-e)<=n*Math.max(1,Math.abs(t),Math.abs(e))},e.RANDOM=e.ARRAY_TYPE=e.EPSILON=void 0;var n=1e-6;e.EPSILON=n;var r="undefined"!=typeof Float32Array?Float32Array:Array;e.ARRAY_TYPE=r;var i=Math.random;e.RANDOM=i;var o=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)})}),P=M(function(t,e){function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.create=n,e.clone=function(t){var e=new i.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},e.fromValues=function(t,e){var n=new i.ARRAY_TYPE(2);return n[0]=t,n[1]=e,n},e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},e.set=function(t,e,n){return t[0]=e,t[1]=n,t},e.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t},e.subtract=r,e.multiply=o,e.divide=u,e.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},e.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},e.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t},e.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t},e.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},e.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t},e.scaleAndAdd=function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t},e.distance=f,e.squaredDistance=c,e.length=l,e.squaredLength=h,e.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},e.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},e.normalize=function(t,e){var n=e[0],r=e[1],r=n*n+r*r;0<r&&(r=1/Math.sqrt(r));return t[0]=e[0]*r,t[1]=e[1]*r,t},e.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},e.cross=function(t,e,n){n=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=n,t},e.lerp=function(t,e,n,r){var i=e[0],e=e[1];return t[0]=i+r*(n[0]-i),t[1]=e+r*(n[1]-e),t},e.random=function(t,e){e=e||1;var n=2*i.RANDOM()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t},e.transformMat2=function(t,e,n){var r=e[0],e=e[1];return t[0]=n[0]*r+n[2]*e,t[1]=n[1]*r+n[3]*e,t},e.transformMat2d=function(t,e,n){var r=e[0],e=e[1];return t[0]=n[0]*r+n[2]*e+n[4],t[1]=n[1]*r+n[3]*e+n[5],t},e.transformMat3=function(t,e,n){var r=e[0],e=e[1];return t[0]=n[0]*r+n[3]*e+n[6],t[1]=n[1]*r+n[4]*e+n[7],t},e.transformMat4=function(t,e,n){var r=e[0],e=e[1];return t[0]=n[0]*r+n[4]*e+n[12],t[1]=n[1]*r+n[5]*e+n[13],t},e.rotate=function(t,e,n,r){var i=e[0]-n[0],o=e[1]-n[1],e=Math.sin(r),r=Math.cos(r);return t[0]=i*r-o*e+n[0],t[1]=i*e+o*r+n[1],t},e.angle=function(t,e){var n=t[0],r=t[1],i=e[0],t=e[1],e=Math.sqrt(n*n+r*r)*Math.sqrt(i*i+t*t),e=e&&(n*i+r*t)/e;return Math.acos(Math.min(Math.max(e,-1),1))},e.zero=function(t){return t[0]=0,t[1]=0,t},e.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},e.equals=function(t,e){var n=t[0],r=t[1],t=e[0],e=e[1];return Math.abs(n-t)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(t))&&Math.abs(r-e)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(e))},e.forEach=e.sqrLen=e.sqrDist=e.dist=e.div=e.mul=e.sub=e.len=void 0;var i=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!==a(t)&&"function"!=typeof t)return{default:t};var e=s();if(e&&e.has(t))return e.get(t);var n,r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in t){var o;Object.prototype.hasOwnProperty.call(t,n)&&((o=i?Object.getOwnPropertyDescriptor(t,n):null)&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=t[n])}r.default=t,e&&e.set(t,r);return r}(Q);function s(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return s=function(){return t},t}function n(){var t=new i.ARRAY_TYPE(2);return i.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function r(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function o(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t}function u(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t}function f(t,e){var n=e[0]-t[0],t=e[1]-t[1];return Math.hypot(n,t)}function c(t,e){var n=e[0]-t[0],t=e[1]-t[1];return n*n+t*t}function l(t){var e=t[0],t=t[1];return Math.hypot(e,t)}function h(t){var e=t[0],t=t[1];return e*e+t*t}e.len=l,e.sub=r,e.mul=o,e.div=u,e.dist=f,e.sqrDist=c,e.sqrLen=h;var p,v=(p=n(),function(t,e,n,r,i,o){var a,s;for(e=e||2,n=n||0,s=r?Math.min(r*e+n,t.length):t.length,a=n;a<s;a+=e)p[0]=t[a],p[1]=t[a+1],i(p,p,o),t[a]=p[0],t[a+1]=p[1];return t});e.forEach=v});function I(t){return{x:t.x,y:-t.y}}var C=((V={})[A.POINT]=function(t,e,n){return n=n.lngLatToPix(t),e.y>n.y?{w:Number.MAX_VALUE,h:Number.MAX_VALUE}:(t=window.devicePixelRatio,{w:Math.abs(n.x-e.x)*t,h:Math.abs(e.y-n.y)*t})},V[A.LINE]=function(t,e,n){var r=Number.MAX_VALUE,i=t.map(function(t){return n.lngLatToPix(t)}),o=i.length;e=I(e);for(var a=P.create(),s=0;s<o;s++){var u=I(i[s]),f=s+1;if(o<=f)break;var c=I(i[f]),l=P.subtract([],[c.x,c.y],[u.x,u.y]);P.equals(a,l)||(f=P.subtract([],[e.x,e.y],[u.x,u.y]),u=P.subtract([],[e.x,e.y],[c.x,c.y]),c=P.dot(f,l),u=P.dot(u,P.negate([],l)),0<c&&0<u&&(c=c/P.length(l),l=P.normalize([],l),c=P.scale([],l,c),f=P.subtract([],c,f),(f=P.length(f))<r&&(r=f)))}return r},V[A.POLYGON]=function(t,e,n){var r=t.map(function(t){return n.lngLatToPix(t)});e=I(e);for(var i=0,o=r.length,a=P.create(),s=0;s<o;s++){var u,f=I(r[s]),c=s+1;if(o<=c)break;f.y!==e.y&&(c=[(u=I(r[c])).x-f.x,u.y-f.y],P.equals(a,c)||0<(e.y-f.y)*(e.y-u.y)||(u=c[1],f=[e.x-f.x,e.y-f.y],0<u*P.cross([],f,c)[2]&&i++))}return i%2==1},V);var O,t=(a(D,O=y),D.prototype.initFeatureInfo=function(t,e){void 0===t&&(t={});var n,r=l(p(e=void 0===e?{}:e),t,[]),e=r.id,t=r.style,r=r.lngLats;this.id="0"===e?(n=(new Date).getTime(),window.performance&&"function"==typeof window.performance.now&&(n+=performance.now()),"id_xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=(n+16*Math.random())%16|0;return n=Math.floor(n/16),("x"==t?e:3&e|8).toString(16)})):e,this.lngLats=r,this.style=t},D.prototype.initDraw=function(){},D.prototype.waiting=function(t){},D.prototype.repaint=function(){},D.prototype.setLngLats=function(t,e){void 0===e&&(e=!1),this.lngLats=p(t),e&&this.editor.repaint()},D.prototype.setId=function(t){var e,n;-1!==this.id.indexOf("id_")&&(n="_",2<(e=this.id.split("_")).length?n+=e.slice(2).join("_"):n="",this.id=""+t+n)},D.prototype.getId=function(){return this.id},D.prototype.project=function(t){var e=this,n=!0;Array.isArray(t)||(n=!(t=[t]));t=t.map(function(t){return e.editor.lngLatToPix(t)});return n?t:0===t.length?null:t[0]},D.prototype.destroy=function(){},D);function D(t,e,n){var r=O.call(this)||this;return r.editor=t,r.initFeatureInfo(e,n),r}var F,R={id:"0",lngLats:[],style:{width:3,color:[26,255,255,255]}},j=(a(Z,F=t),Z.prototype.initDraw=function(){var t=this.editor.regl;this.positionBuffer=t.buffer({usage:"dynamic",type:"float"}),this.offsetBuffer=t.buffer({usage:"dynamic",type:"float"}),this.elements=t.elements({primitive:"triangles",usage:"dynamic",type:"uint16",count:0,length:0})},Z.prototype.waiting=function(t){var a=this,s=this.lngLats,u=this.bufferPixes;t(function(t,e){var n=s.length;if(n<1)s.push(t),a.editor.context.enter(d.EDITING);else{var r=a.project(t),i=s[n-2],o=a.project(i),i=Math.abs(o.x-r.x),r=Math.abs(o.y-r.y);if(i<=u&&r<=u)return s.splice(n-1,1),e(),void a.editor.drawFinish(a);s[n-1]=t}s.push(t),a.editor.repaint()},function(t){var e=s.length;0!==e&&(s[e-1]=t,a.editor.repaint())})},Z.prototype.repaint=function(){var t=this.lngLats;if(!(t.length<=1)){for(var e=this.project(t),n=e.length,r=[],i=0;i<n;i++){var o=e[i];r.push(o.x,o.y)}c.pushElement(r,n-1,2),c.unshiftElement(r,0,2);var a=new Float32Array(c.duplicate(r,2)),s=new Array(n).fill(1),t=c.duplicate(s,1,-1),s=u.lineMesh([],n,0);this.positionBuffer(a),this.offsetBuffer(t),this.elements(s)}},Z);function Z(t,e){e=F.call(this,t,e,R)||this;return e.bufferSelected=6,e.bufferPixes=3,e.featureType=A.LINE,e.initDraw(),e}var N,e=(a(S,N=t),S);function S(){return null!==N&&N.apply(this,arguments)||this}var k,T={0:{width:27,height:42,x:1,y:44}},G={id:"0",lngLats:null,style:{code:"0",color:[0,0,0,0]}},z=(a(U,k=t),U.prototype.initDraw=function(){var t=this.editor,e=t.regl,t=t.texture;if(!t)throw new Error("Texture is not loaded.");this.texture=e.texture({width:512,height:128,data:t}),this.positionBuffer=e.buffer({usage:"dynamic",type:"float"}),this.texCoordBuffer=e.buffer({usage:"dynamic",type:"float"}),this.elements=e.elements({primitive:"triangles",usage:"dynamic",type:"uint16",count:0,length:0})},U.prototype.waiting=function(t){var n=this,r=this.editor.context;t(function(t,e){r.enter(d.EDITING),n.lngLats=t,e(),n.editor.drawFinish(n)},function(t){})},U.prototype.repaint=function(){if(this.lngLats){for(var t=this.project(this.lngLats),e=this.style.code,e=T[void 0===e?"0":e],n=e.width,r=e.height,i=e.x,o=e.y,a=window.devicePixelRatio,s=n/2,u=[],f=0;f<4;f++){var c=t.x+-1*Math.pow(-1,f%2)*(s/a),l=t.y+(Math.floor(f/2)-1)*(r/a);u.push(c,l)}this.positionBuffer(u);for(var h=[],p=0;p<4;p++){var v=i+n*(p%2),A=o+r*Math.floor(p/2);h.push(v/512,A/128)}this.texCoordBuffer(h);this.elements([0,1,2,2,1,3])}},U);function U(t,e){e=k.call(this,t,e,G)||this;return e.bufferSelected={w:14,h:42},e.featureType=A.POINT,e.initDraw(),e}var W=Y,V=Y;function Y(t,e,n){n=n||2;var r,i,o,a,s,u=e&&e.length,f=u?e[0]*n:t.length,c=H(t,0,f,n,!0),l=[];if(!c||c.next===c.prev)return l;if(u&&(c=function(t,e,n,r){var i,o,a,s,u=[];for(i=0,o=e.length;i<o;i++)a=e[i]*r,s=i<o-1?e[i+1]*r:t.length,(s=H(t,a,s,r,!1))===s.next&&(s.steiner=!0),u.push(function(t){var e=t,n=t;for(;(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next,e!==t;);return n}(s));for(u.sort(K),i=0;i<u.length;i++)!function(t,e){(e=function(t,e){var n,r=e,i=t.x,o=t.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&a<s){if((a=s)===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}}while(r=r.next,r!==e);if(!n)return null;if(i===a)return n;var u,f=n,c=n.x,l=n.y,h=1/0;r=n;for(;i>=r.x&&r.x>=c&&i!==r.x&&_(o<l?i:a,o,c,l,o<l?a:i,o,r.x,r.y)&&(u=Math.abs(o-r.y)/(i-r.x),it(r,t)&&(u<h||u===h&&(r.x>n.x||r.x===n.x&&function(t,e){return $(t.prev,t,e.prev)<0&&$(e.next,t,t.next)<0}(n,r)))&&(n=r,h=u)),r=r.next,r!==f;);return n}(t,e))&&(t=ot(e,t),J(e,e.next),J(t,t.next))}(u[i],n),n=J(n,n.next);return n}(t,e,c,n)),t.length>80*n){for(var h=r=t[0],p=i=t[1],v=n;v<f;v+=n)(o=t[v])<h&&(h=o),(a=t[v+1])<p&&(p=a),r<o&&(r=o),i<a&&(i=a);s=0!==(s=Math.max(r-h,i-p))?1/s:0}return X(c,l,n,h,p,s),l}function H(t,e,n,r,i){var o,a;if(i===0<ft(t,e,n,r))for(o=e;o<n;o+=r)a=at(o,t[o],t[o+1],a);else for(o=n-r;e<=o;o-=r)a=at(o,t[o],t[o+1],a);return a&&tt(a,a.next)&&(st(a),a=a.next),a}function J(t,e){if(!t)return t;e=e||t;var n,r=t;do{if(n=!1,r.steiner||!tt(r,r.next)&&0!==$(r.prev,r,r.next))r=r.next;else{if(st(r),(r=e=r.prev)===r.next)break;n=!0}}while(n||r!==e);return e}function X(t,e,n,r,i,o,a){if(t){!a&&o&&function(t,e,n,r){for(var i=t;null===i.z&&(i.z=q(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next,i!==t;);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,n,r,i,o,a,s,u,f=1;do{for(n=t,o=t=null,a=0;n;){for(a++,r=n,e=s=0;e<f&&(s++,r=r.nextZ);e++);for(u=f;0<s||0<u&&r;)0!==s&&(0===u||!r||n.z<=r.z)?(n=(i=n).nextZ,s--):(r=(i=r).nextZ,u--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;n=r}}while(o.nextZ=null,f*=2,1<a)}(i)}(t,r,i,o);for(var s,u,f=t;t.prev!==t.next;)if(s=t.prev,u=t.next,o?function(t,e,n,r){var i=t.prev,o=t,a=t.next;if(0<=$(i,o,a))return!1;var s=(i.x<o.x?i.x<a.x?i:a:o.x<a.x?o:a).x,u=(i.y<o.y?i.y<a.y?i:a:o.y<a.y?o:a).y,f=(i.x>o.x?i.x>a.x?i:a:o.x>a.x?o:a).x,c=(i.y>o.y?i.y>a.y?i:a:o.y>a.y?o:a).y,l=q(s,u,e,n,r),h=q(f,c,e,n,r),p=t.prevZ,v=t.nextZ;for(;p&&p.z>=l&&v&&v.z<=h;){if(p!==t.prev&&p!==t.next&&_(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&0<=$(p.prev,p,p.next))return!1;if(p=p.prevZ,v!==t.prev&&v!==t.next&&_(i.x,i.y,o.x,o.y,a.x,a.y,v.x,v.y)&&0<=$(v.prev,v,v.next))return!1;v=v.nextZ}for(;p&&p.z>=l;){if(p!==t.prev&&p!==t.next&&_(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&0<=$(p.prev,p,p.next))return!1;p=p.prevZ}for(;v&&v.z<=h;){if(v!==t.prev&&v!==t.next&&_(i.x,i.y,o.x,o.y,a.x,a.y,v.x,v.y)&&0<=$(v.prev,v,v.next))return!1;v=v.nextZ}return!0}(t,r,i,o):function(t){var e=t.prev,n=t,r=t.next;if(0<=$(e,n,r))return!1;var i=t.next.next;for(;i!==t.prev;){if(_(e.x,e.y,n.x,n.y,r.x,r.y,i.x,i.y)&&0<=$(i.prev,i,i.next))return!1;i=i.next}return!0}(t))e.push(s.i/n),e.push(t.i/n),e.push(u.i/n),st(t),t=u.next,f=u.next;else if((t=u)===f){a?1===a?X(t=function(t,e,n){var r=t;do{var i=r.prev,o=r.next.next}while(!tt(i,o)&&et(i,r,r.next,o)&&it(i,o)&&it(o,i)&&(e.push(i.i/n),e.push(r.i/n),e.push(o.i/n),st(r),st(r.next),r=t=o),r=r.next,r!==t);return J(r)}(J(t),e,n),e,n,r,i,o,2):2===a&&function(t,e,n,r,i,o){var a=t;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&function(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&et(n,n.next,t,e))return!0}while(n=n.next,n!==t);return!1}(t,e)&&(it(t,e)&&it(e,t)&&function(t,e){var n=t,r=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;for(;n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next,n!==t;);return r}(t,e)&&($(t.prev,t,e.prev)||$(t,e.prev,e))||tt(t,e)&&0<$(t.prev,t,t.next)&&0<$(e.prev,e,e.next))}(a,s)){var u=ot(a,s);return a=J(a,a.next),u=J(u,u.next),X(a,e,n,r,i,o),X(u,e,n,r,i,o)}s=s.next}}while((a=a.next)!==t)}(t,e,n,r,i,o):X(J(t),e,n,r,i,o,1);break}}}function K(t,e){return t.x-e.x}function q(t,e,n,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function _(t,e,n,r,i,o,a,s){return 0<=(i-a)*(e-s)-(t-a)*(o-s)&&0<=(t-a)*(r-s)-(n-a)*(e-s)&&0<=(n-a)*(o-s)-(i-a)*(r-s)}function $(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function tt(t,e){return t.x===e.x&&t.y===e.y}function et(t,e,n,r){var i=rt($(t,e,n)),o=rt($(t,e,r)),a=rt($(n,r,t)),s=rt($(n,r,e));return i!==o&&a!==s||(0===i&&nt(t,n,e)||(0===o&&nt(t,r,e)||(0===a&&nt(n,t,r)||!(0!==s||!nt(n,e,r)))))}function nt(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function rt(t){return 0<t?1:t<0?-1:0}function it(t,e){return $(t.prev,t,t.next)<0?0<=$(t,e,t.next)&&0<=$(t,t.prev,e):$(t,e,t.prev)<0||$(t,t.next,e)<0}function ot(t,e){var n=new ut(t.i,t.x,t.y),r=new ut(e.i,e.x,e.y),i=t.next,o=e.prev;return(t.next=e).prev=t,(n.next=i).prev=n,(r.next=n).prev=r,(o.next=r).prev=o,r}function at(t,e,n,r){n=new ut(t,e,n);return r?(n.next=r.next,(n.prev=r).next.prev=n,r.next=n):(n.prev=n).next=n,n}function st(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function ut(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ft(t,e,n,r){for(var i=0,o=e,a=n-r;o<n;o+=r)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}Y.deviation=function(t,e,n,r){var i=e&&e.length,o=i?e[0]*n:t.length,a=Math.abs(ft(t,0,o,n));if(i)for(var s=0,u=e.length;s<u;s++){var f=e[s]*n,c=s<u-1?e[s+1]*n:t.length;a-=Math.abs(ft(t,f,c,n))}for(var l=0,s=0;s<r.length;s+=3){var h=r[s]*n,p=r[s+1]*n,v=r[s+2]*n;l+=Math.abs((t[h]-t[v])*(t[1+p]-t[1+h])-(t[h]-t[p])*(t[1+v]-t[1+h]))}return 0===a&&0===l?0:Math.abs((l-a)/a)},Y.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var a=0;a<e;a++)n.vertices.push(t[i][o][a]);0<i&&(r+=t[i-1].length,n.holes.push(r))}return n},W.default=V;var ct,lt={id:"0",lngLats:[],style:{color:[255,0,0,125],borderColor:[255,0,0,255]}},V=(a(ht,ct=t),ht.prototype.initDraw=function(){var t=this.editor.regl;this.positionBuffer=t.buffer({usage:"dynamic",type:"float"}),this.elements=t.elements({primitive:"triangles",usage:"dynamic",type:"uint16",count:0,length:0})},ht.prototype.createBorder=function(t){var e=this.id+"_border";this.border=new j(t,{id:e,lngLats:this.lngLats,style:{color:this.style.borderColor}})},ht.prototype.waiting=function(t){var a=this,s=this.editor.context,u=this.bufferPixes,f=this.lngLats;t(function(t,e){var n=f.length;if(n<1)s.enter(d.EDITING),f.push(t),f.push(t);else{var r=f[n-3],i=a.project(r),o=a.project(t),r=Math.abs(i.x-o.x),o=Math.abs(i.y-o.y);if(r<=u&&o<=u)return f.splice(n-2,1),a.border.setLngLats(f),e(),void a.editor.drawFinish(a)}n=f.length,f.splice(n-2,0,t),a.border.setLngLats(f),a.editor.repaint()},function(t){var e=f.length;0!==e&&(f[e-2]=t,a.border.setLngLats(f),a.editor.repaint())})},ht.prototype.repaint=function(){var t=this.lngLats;if(!(t.length<=1)){for(var e=this.project(t),n=[],r=0;r<e.length;r++){var i=e[r];n.push(i.x,i.y)}t=W(n);0===t.length&&(t=[0,1,2]),this.positionBuffer(n),this.elements(t)}},ht);function ht(t,e){e=ct.call(this,t,e,lt)||this;return e.bufferPixes=3,e.featureType=A.POLYGON,e.initDraw(),e.createBorder(t),e}var pt,vt=((t={})[A.POLYGON]=V,t[A.BORDER]=j,t[A.LINE]=j,t[A.NODE]=e,t[A.POINT]=z,t),At=(a(dt,pt=y),dt.prototype.init=function(){var t;this.features=((t={})[A.POLYGON]=[],t[A.LINE]=[],t[A.POINT]=[],t),this.drawingFeature=null,this.selectedFeature=null,this.isRefresh=!1},dt.prototype.registerEvent=function(){this.regl._gl.canvas.addEventListener("mousedown",this.mousedown.bind(this)),this.regl._gl.canvas.addEventListener("mouseup",this.mouseup.bind(this)),this.regl._gl.canvas.addEventListener("mousemove",this.pickHover.bind(this)),this.regl._gl.canvas.addEventListener("click",this.pickClick.bind(this))},dt.prototype.mousedown=function(t){var e=t.clientX,t=t.clientY;this.downPix={x:e,y:t}},dt.prototype.mouseup=function(t){var e=t.clientX,t=t.clientY;this.upPix={x:e,y:t}},dt.prototype.pickClick=function(t){var e;this.downPix.x===this.upPix.x&&this.downPix.y===this.upPix.y&&((e=this.context.mode)===d.WATING||e===d.EDITING||(t=this.pickFeature(t))&&this.fire("picked:click",{type:"click",feature:t}))},dt.prototype.pickHover=function(t){t=this.pickFeature(t);t?this.context.hover(t.featureType,!0):this.context.out()},dt.prototype.pickFeature=function(t){var e=t.clientX,n=t.clientY,t=this.config.mapContainer.getBoundingClientRect(),t={x:e-t.left,y:n-t.top};return function(t,e,n){for(var r=0,i=[A.POINT,A.LINE,A.POLYGON];r<i.length;r++)for(var o=i[r],a=t[o],s=C[o],u=0,f=a;u<f.length;u++){var c=f[u],l=s(c.lngLats,e,n);if(o===A.POINT){if(l.w<c.bufferSelected.w&&l.h<c.bufferSelected.h)return c}else if(o===A.LINE){if(l<=c.bufferSelected)return c}else if(o===A.POLYGON&&l)return c}return null}(this.features,t,this)},dt.prototype.render=function(a,s){var u=this;void 0===a&&(a={}),void 0===s&&(s=!0);for(var t=[A.POLYGON,A.LINE,A.POINT],f=this,e=0,n=t;e<n.length;e++)!function(e){var t=f.features[e];if(f.features[e]=[],s)for(var n=0,r=t;n<r.length;n++){var i=r[n];i.id.startsWith("id_")&&f.features[e].push(i)}var o=(t=a[e]||[]).map(function(t){return new vt[e](u,t)});(t=f.features[e]).push.apply(t,o)}(n[e]);this.repaint()},dt.prototype.start=function(t,e){this.context.enter(d.WATING),this.drawingFeature&&(this.drawingFeature=null,this.repaint()),this.drawingFeature=new vt[t](this),this.drawingFeature.waiting(e)},dt.prototype.drawFinish=function(t){this.context.enter(d[t.featureType.toUpperCase()+"_SELECT"]),this.drawingFeature&&(this.addFeature(this.drawingFeature),this.selectedFeature=this.drawingFeature,this.fire("finish",this.drawingFeature),this.drawingFeature=null,this.repaint())},dt.prototype.repaint=function(){var n,t,e,r=this;this.regl&&(this.refresh(),n=[],[A.POLYGON,A.LINE,A.POINT].forEach(function(t){var e=r.features[t].map(function(t){return t.featureType===A.POLYGON&&n.push(r.featureMap(t.border)),r.featureMap(t)});0<e.length&&r.drawBatch(t,e),t===A.POLYGON&&0<n.length&&r.drawBatch(A.BORDER,n)}),this.drawingFeature&&(t=this.featureMap(this.drawingFeature),e=this.drawingFeature.featureType,this.drawBatch(e,t),e===A.POLYGON&&(e=this.drawingFeature,e=this.featureMap(e.border),this.drawBatch(A.BORDER,e))))},dt.prototype.featureMap=function(t){t.repaint();var e=t.featureType,n=t.positionBuffer,r=t.elements,i=t.style,o=this.getModelMatrix(),a=f({positionBuffer:n,modelMatrix:o,elements:r},i);switch(e){case A.BORDER:case A.LINE:var s=t.offsetBuffer;return f(f({},a),{offsetBuffer:s});case A.POLYGON:case A.NODE:return a;case A.POINT:var u=t.texCoordBuffer,s=t.texture;return f(f({},a),{texCoordBuffer:u,texture:s})}},dt.prototype.drawBatch=function(t,e){var n=this,r=t!==A.LINE&&t!==A.BORDER;this.regl({blend:{enable:r,func:{src:"src alpha",dst:"one minus src alpha"}},depth:{mask:!1}})(function(){n.drawCalls[t](e)})},dt.prototype.refresh=function(){var t,e,n,r=this.regl,i=this.config.mapContainer;this.isRefresh&&(t=window.devicePixelRatio,e=i.clientWidth,n=i.clientHeight,(i=r._gl.canvas).width=e*t,i.height=n*t,i.style.width=e+"px",i.style.height=n+"px",this.isRefresh=!1,r._refresh()),r.clear({color:[0,0,0,0],depth:1})},dt.prototype.addFeature=function(t){var e=t.featureType,e=this.features[e];e.includes(t)||e.push(t)},dt.prototype.changeIds=function(t){var r=this;void 0===t&&(t={}),Object.keys(t).forEach(function(e){var n=t[e];Object.keys(r.features).forEach(function(t){t=r.features[t].find(function(t){return-1<t.id.indexOf(e)});t&&t.setId(n)})})},dt.prototype.lngLatToPix=function(t){return this.config.lngLatToPix(t)},dt.prototype.getModelMatrix=function(){return this.config.getModelMatrix()},dt.prototype.clear=function(){this.init(),this.repaint()},dt);function dt(t,e){var n=pt.call(this)||this;return n.isRefresh=!1,n.context=new w({gl:t}),n.regl=i.default(t),n.config=e,n.drawCalls=function(t){var e,n={};for(e in L)n[e]=L[e](t);return n}(n.regl),function(t,e){const n=new Image;n.src=t,n.onload=function(){e(n)}}("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAACACAMAAABKiSE5AAADJmlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxMTEgNzkuMTU4MzI1LCAyMDE1LzA5LzEwLTAxOjEwOjIwICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxNSAoV2luZG93cykiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NkRCMEZBMTA4Qjc3MTFFQjhBM0JGMkFBMDI0ODQyOEMiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6NkRCMEZBMTE4Qjc3MTFFQjhBM0JGMkFBMDI0ODQyOEMiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo2REIwRkEwRThCNzcxMUVCOEEzQkYyQUEwMjQ4NDI4QyIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo2REIwRkEwRjhCNzcxMUVCOEEzQkYyQUEwMjQ4NDI4QyIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PrB+ZBgAAAAZdEVYdFNvZnR3YXJlAEFkb2JlIEltYWdlUmVhZHlxyWU8AAACZ1BMVEVHcEzy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",function(t){n.texture=t,n.fire("load")}),n.init(),n.registerEvent(),n}const{Renderer:yt,DomEvent:{on:xt,off:gt},Util:{cancelAnimFrame:mt},DomUtil:{remove:wt,setPosition:bt}}=r.default,Bt=yt.extend({clickFn:null,moveFn:null,getEvents:function(){var t=yt.prototype.getEvents.call(this);return t.move=this._update,t.movestart=this._movestart,t},onAdd:function(){yt.prototype.onAdd.call(this),this.createEditor()},_initContainer:function(){var t=this._container=document.createElement("canvas");if(xt(t,"mousemove",this._onMouseMove,this),xt(t,"click dblclick mousedown mouseup contextmenu",this._onClick,this),xt(t,"mouseout",this._onMouseOut,this),this.gl=t.getContext("webgl"),!this.gl)throw new Error("Webgl is not supported in your broswer")},createEditor:function(){var t=this._map.getContainer();this._editor=new At(this.gl,{lngLatToPix:this.lngLatToPoint.bind(this),getModelMatrix:this.getModelMatrix.bind(this),mapContainer:t}),this._editor.on("picked:click picked:mousemove",({type:t,feature:e})=>{e?("mousemove"===t&&(t="hover"),this.fire(`picked:${t}`,{feature:e})):console.log("error:",e._id)}),this._editor.on("finish",t=>{this.fire("finish",{feature:t})}),this._editor.on("load",()=>{this.fire("load")}),this._map.on("resize",()=>{this._editor.isRefresh=!0,this._editor.repaint()})},start:function(t){if(!this._editor)throw new Error("未添加编辑器图层");var{doubleClickZoom:r}=this._map.options;r&&this._map.doubleClickZoom.disable(),this.clickFn&&this._map.off("click",this.clickFn),this.moveFn&&this._map.off("mousemove",this.moveFn),this._editor.start(t,(e,n)=>{this.clickFn=t=>{t=t.latlng;e(t,()=>{this._map.off("click",this.clickFn),this._map.off("mousemove",this.moveFn),this.clickFn=null,this.moveFn=null,r&&setTimeout(()=>{this._map.doubleClickZoom.enable()},200)})},this.moveFn=t=>{t=t.latlng;n(t)},this._map.on("click",this.clickFn),this._map.on("mousemove",this.moveFn)})},render:function(t,e){if(!this._editor)throw new Error("gl-editor 初始化失败！");this._editor.render(t,e)},getFeature:function(t){this._editor.getFeature(t)},changeIds:function(t){this._editor.changeIds(t)},clear:function(){this._editor.clear()},_update:function(){yt.prototype._update.call(this);const t=this._bounds,e=this._container,n=t.getSize(),r=window.devicePixelRatio;bt(e,t.min),e.width=r*n.x,e.height=r*n.y,e.style.width=n.x+"px",e.style.height=n.y+"px",this._editor&&this._editor.repaint()},lngLatToPoint:function(t){var{x:e,y:t}=this._map.latLngToContainerPoint(r.default.latLng(t.lat,t.lng));return{x:e,y:t}},getModelMatrix:function(){var t=this._map.getContainer();return[2/t.clientWidth,0,0,0,-2/t.clientHeight,0,-1,1,1]},_onClick:function(t){},_movestart:function(){},_onMouseMove:function(t){!this._map||this._map.dragging.moving()||this._map._animatingZoom},_onMouseOut:function(t){},_onMouseHover:function(t,e){},_fireEvent:function(t,e,n){this._map._fireDOMEvent(e,n||e.type,t)},_destroyContainer:function(){mt(this._redrawRequest),delete this.gl,wt(this._container),gt(this._container),delete this._container}});let Et=null;return function(){if(Et)throw new Error("GlEditor has been initialized!");return Et=new Bt({padding:0}),Et}});
