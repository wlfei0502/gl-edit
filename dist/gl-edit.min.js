!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("leaflet"),require("regl")):"function"==typeof define&&define.amd?define(["leaflet","regl"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).glEdit=e(t.L,t.regl)}(this,function(t,e){"use strict";function i(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var n=i(t),o=i(e),a={lineMesh:function(e,i,n){for(let t=0;t<i-1;t++){var o=n+2*t,r=o+1,h=o+2,a=o+3;e.push(o,r,h,h,r,a)}return e}},s={duplicate:function(i,n,o){null==n&&(n=1),null==o&&(o=1);var r=[];const h=new Array(2*n);for(let t=0,e=i.length/n;t<e;t++){var a=t*n;for(let t=0;t<n;t++){var s=i[a+t];h[t]=s,h[t+n]=s*o}Array.prototype.push.apply(r,h)}return r},mapElement:function(i,n,o,r){for(let t=0,e=i.length/o;t<e;t++){var h=n+t*o;i[h]=r(i[h],h,t)}return i},pushElement:function(e,t,i){const n=new Array(i);var o=t*i;for(let t=0;t<i;t++)n[t]=e[o+t];return Array.prototype.push.apply(e,n),e},unshiftElement:function(e,t,i){const n=new Array(i);var o=t*i;for(let t=0;t<i;t++)n[t]=e[o+t];return Array.prototype.unshift.apply(e,n),e}};function h(t){return((t=t).trim?t.trim():t.replace(/^\s+|\s+$/g,"")).split(/\s+/)}var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)};function l(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var y,u,x=function(){return(x=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function p(){return!1}(v=y=y||{}).POLYGON="polygon",v.BORDER="border",v.LINE="line",v.NODE="node",v.POINT="point",(t=u=u||{}).IDLE="idle",t.WATING="waiting",t.EDITING="editing",t.END="end",t.POINT_SELECT="point_select",t.LINE_SELECT="line_select",t.POLYGON_SELECT="polygon_select",t.NODE_SELECT="node_select";c.prototype.on=function(t,e,i){if("object"==typeof t)for(var n in t)this._on(n,t[n],e);else for(var o=0,r=(t=h(t)).length;o<r;o++)this._on(t[o],e,i);return this},c.prototype.off=function(t,e,i){if(t)if("object"==typeof t)for(var n in t)this._off(n,t[n],e);else for(var o=0,r=(t=h(t)).length;o<r;o++)this._off(t[o],e,i);else delete this._events;return this},c.prototype._on=function(t,e,i){this._events=this._events||{};var n=this._events[t];n||(n=[],this._events[t]=n);for(var t={fn:e,ctx:i=i||this},o=n,r=0,h=o.length;r<h;r++)if(o[r].fn===e&&o[r].ctx===i)return;o.push(t)},c.prototype._off=function(t,e,i){var n,o,r;if(this._events&&(n=this._events[t]))if(e){if(i=i||this,n)for(o=0,r=n.length;o<r;o++){var h=n[o];if(h.ctx===i&&h.fn===e)return h.fn=p,this._firingCount&&(this._events[t]=n=n.slice()),void n.splice(o,1)}}else{for(o=0,r=n.length;o<r;o++)n[o].fn=p;delete this._events[t]}},c.prototype.fire=function(t,e){if(!this.listens(t))return this;if(this._events){var i=this._events[t];if(i){this._firingCount=this._firingCount+1||1;for(var n=0,o=i.length;n<o;n++){var r=i[n];r.fn.call(r.ctx||this,e)}this._firingCount--}}return this},c.prototype.listens=function(t){t=this._events&&this._events[t];return!(!t||!t.length)},e=c;function c(){this._events={}}var f=(g.prototype.getColor=function(t){!function t(e,i){var n=e[i];if(n+1<=255)return n+=1,void(e[i]=n);e[i]=0,t(e,i+1)}(this._currentColor,0);var e=this._currentColor.join("-");return this._colors[e]=t,this._uuids[t]=e,function(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;for(var n=Array(t),o=0,e=0;e<i;e++)for(var r=arguments[e],h=0,a=r.length;h<a;h++,o++)n[o]=r[h];return n}(this._currentColor)},g.prototype.getUUID=function(t){return this._colors[t]},g.prototype.changeUuid=function(t,e){var i=this._uuids[t];this._uuids[e]=i,this._colors[i]=e,delete this._uuids[t]},g);function g(){this._colors={},this._uuids={},this._currentColor=[0,0,0,0]}var d,v="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAeklEQVR4AWMgAvABcQEQFwGxEgMVQNq6desKV69eXQIxlHLQ8P//fzAGsQeHgaMGOiAZ6ECMBiVocmhAw7gMcMCuFpFOi9avX18McQUmRjcNlzqQGbB0WgBKuJQaCDIDZBYsa6VR6mWoGXwkR8qwS4ejBlJewFJeBQAAqLzY76D65MUAAAAASUVORK5CYII=",t="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAABG0lEQVR4AbWTMWi0QBBG/+LA/hrZ5u/PHvu+Lw6s7QkBk85Nawqxuz6SUsukr84eu5QBSXoCImazDxS8DZG4Sz54MIzjY53Ff38VNXHWHDU7ZyFpmkZFUaQ8z3vVvRvN3lZ4Rjan6zolpVRCiA/97KQ5bBUeOZmZvu9VWZYqDMNPPfO0RbjjMznZT5l2vCm3aZqagiVyq3DPzvjMhdA5J3ZmCP9rYo1chRlmjRy4AEMY13V9rVtyDWYm6bc8Gzu7eHEYhrssyx6Bevnst3u+kPm+/z5fFDU9ayGnQpTneQnU9KyFRVE8mEJ61kIQQrwhAmqnHUKSJPUspHYWjuMogyB4AWpnIbRtew/UNsK4qqorXliDGWZXTTa/3hfS9r3bdRtDEgAAAABJRU5ErkJggg==",w={waiting:v,editing:v,point:t,node:t,line:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAABCElEQVR4AbWTAWbGQBCFi0hIBAIECkAukLOEAGEPUEULZE8RAaUEQAJoe4PkHiUHaFsWOp3HLrGVrv3X/3hWJuMz85K9uZZIe2U37CgYCG3bRm3bUpIk71x7YBeXAlfAjPZ9JykllWX5ze9GduULbDCZLaUUTdNEdV3/cM+LDzDCmpjsTDpjLz32fX8E2Ja+wAKZYc0DMFgjMrOAt2zBlg4L9NrACh/AAoplWe65JP8zejT0j16tzE4hXde9ZVn2iRPPzpxdwDRNv4gFaDBwGIbnOI4VoMETAoapnlim5gl0w7yBWAvrYU0DCwLq4AlQAwieMM/zD5yhQDHP853rx0YPet04z6v3C3dEyAkWQDzRAAAAAElFTkSuQmCC",polygon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAA0klEQVR4Ae2TMQ6CQBBFLUjo6WjsuQBnIaHeAxgL7ZhjcABqKPUIcA8TbmBC4zjfYNQxuI5EK3/ymnF82f0bFt8Kj7RCJgSzhUjXdZznOYdheJDZRog+FbaQXdP3PRMRx3F8lN9KIbEKM5xMZxgGrqqK0zQ9yc7OIgxwTZxsKmPHpmyLongQKMgqjNAZrnkTzk+JzpRwKTiBPLjLrkqCB1BC1zTNWkb0CuyM0qfsVWeTEs27Pes/8T2zhEqgZn/hrx/Fg03o6rpe+WTYwa7HZf/0zi/2zDOd9wpPAAAAAElFTkSuQmCC"},A=(l(m,d=e),m.prototype.enter=function(t){this.mode=t,this.hover(this.mode,!1)},m.prototype.exit=function(){this.mode=u.IDLE,this.hover(this.mode,!1)},m.prototype.hover=function(t,e){t=w[t];t?(this._hover=e,this._gl.canvas.style.cursor="url("+t+") 9 9,auto"):this._gl.canvas.style.cursor="inherit"},m.prototype.out=function(){this._hover&&this.hover(this.mode,!1)},m.prototype.setMapStatus=function(t){this.mapStatus=t},m);function m(t){var e=t.gl,i=t.shapeConfig,t=d.call(this)||this;return t.mode="",t.mapStatus="",t.pixDis=3,t._hover=!1,t._texture=null,t._gl=e,t._regl=o.default(t._gl),t._shapeConfig=i,t.color=new f,t}var _={0:{width:27,height:42,x:1,y:44},1:{pixelRatio:2,width:28,height:28,x:369,y:394},dasha1:{pixelRatio:2,width:28,height:28,x:285,y:394},dian1:{pixelRatio:2,width:28,height:28,x:313,y:394},dijishi1:{pixelRatio:2,width:28,height:28,x:341,y:394},gaoerfu1:{pixelRatio:2,width:28,height:28,x:397,y:394},gonganju1:{pixelRatio:2,width:28,height:28,x:0,y:426},gongmu1:{pixelRatio:2,width:28,height:28,x:28,y:426},gongjiaozhan1:{pixelRatio:2,width:28,height:28,x:56,y:426},guangzhou1:{pixelRatio:2,width:28,height:28,x:84,y:426},haerbin1:{pixelRatio:2,width:28,height:28,x:112,y:426},guowaishoudu1:{pixelRatio:2,width:28,height:28,x:140,y:426},hangzhou1:{pixelRatio:2,width:28,height:28,x:168,y:426},hongb1:{pixelRatio:2,width:28,height:28,x:196,y:426},jiansheyinhang1:{pixelRatio:2,width:28,height:28,x:224,y:426},jiayouzhan1:{pixelRatio:2,width:28,height:28,x:252,y:426},jiuba1:{pixelRatio:2,width:28,height:28,x:280,y:426},jiudian1:{pixelRatio:2,width:28,height:28,x:308,y:426},kfc1:{pixelRatio:2,width:28,height:28,x:336,y:426},ktv1:{pixelRatio:2,width:28,height:28,x:364,y:426},kunming1:{pixelRatio:2,width:28,height:28,x:392,y:426},kafeiting1:{pixelRatio:2,width:28,height:28,x:446,y:305},lanb1:{pixelRatio:2,width:28,height:28,x:420,y:426},lanc1:{pixelRatio:2,width:28,height:28,x:443,y:204},lvb1:{pixelRatio:2,width:28,height:28,x:436,y:333},lvc1:{pixelRatio:2,width:28,height:28,x:423,y:233},lvguan1:{pixelRatio:2,width:28,height:28,x:422,y:362},ningbo1:{pixelRatio:2,width:28,height:28,x:425,y:394},nonghang1:{pixelRatio:2,width:28,height:28,x:439,y:168},qicheweixiu1:{pixelRatio:2,width:28,height:28,x:425,y:265},quxian1:{pixelRatio:2,width:28,height:28,x:422,y:0},shan1:{pixelRatio:2,width:28,height:28,x:420,y:56},shangchang1:{pixelRatio:2,width:28,height:28,x:438,y:112},shanghai1:{pixelRatio:2,width:28,height:28,x:0,y:454},shenghui1:{pixelRatio:2,width:28,height:28,x:28,y:454},shenyang1:{pixelRatio:2,width:28,height:28,x:56,y:454},simiao1:{pixelRatio:2,width:28,height:28,x:84,y:454},tingchechang1:{pixelRatio:2,width:28,height:28,x:112,y:454},wuxi1:{pixelRatio:2,width:28,height:28,x:140,y:454},xian1:{pixelRatio:2,width:28,height:28,x:168,y:454},xican1:{pixelRatio:2,width:28,height:28,x:196,y:454},xuexiao1:{pixelRatio:2,width:28,height:28,x:224,y:454},yaodian1:{pixelRatio:2,width:28,height:28,x:252,y:454},yinyueting1:{pixelRatio:2,width:28,height:28,x:280,y:454},yiyuan1:{pixelRatio:2,width:28,height:28,x:308,y:454},zhengfujiguan1:{pixelRatio:2,width:28,height:28,x:336,y:454},zhengzhou1:{pixelRatio:2,width:28,height:28,x:364,y:454},youju1:{pixelRatio:2,width:28,height:28,x:392,y:454},youlechang1:{pixelRatio:2,width:28,height:28,x:420,y:454},zhaoshangyinhang1:{pixelRatio:2,width:28,height:28,x:474,y:305},zhongcan1:{pixelRatio:2,width:28,height:28,x:448,y:426},zhongguoyinhang1:{pixelRatio:2,width:28,height:28,x:448,y:454},zhuzhai1:{pixelRatio:2,width:28,height:28,x:471,y:204},suzhout1:{pixelRatio:2,width:36,height:20,x:464,y:333},aoment1:{pixelRatio:2,width:28,height:24,x:451,y:233},fuzhout1:{pixelRatio:2,width:28,height:24,x:450,y:362},jie2:{pixelRatio:2,width:33,height:19,x:453,y:394},changzhout1:{pixelRatio:2,width:25,height:24,x:476,y:426},gaoxiongt1:{pixelRatio:2,width:30,height:20,x:467,y:168},jinant1:{pixelRatio:2,width:25,height:24,x:476,y:454},beijinga1:{pixelRatio:2,width:24,height:24,x:478,y:362},changzhoua1:{pixelRatio:2,width:24,height:24,x:453,y:265},dongguana1:{pixelRatio:2,width:24,height:24,x:477,y:265},dongguant1:{pixelRatio:2,width:24,height:24,x:450,y:0},fuzhoua1:{pixelRatio:2,width:24,height:24,x:474,y:0},gonghang1:{pixelRatio:2,width:24,height:24,x:448,y:56},gongyuan1:{pixelRatio:2,width:24,height:24,x:472,y:56},guangfa1:{pixelRatio:2,width:24,height:24,x:466,y:112},guiyanga1:{pixelRatio:2,width:24,height:24,x:0,y:482},guiyangt1:{pixelRatio:2,width:24,height:24,x:24,y:482},hefeit1:{pixelRatio:2,width:24,height:24,x:48,y:482},hefeia1:{pixelRatio:2,width:24,height:24,x:72,y:482},honga1:{pixelRatio:2,width:24,height:24,x:96,y:482},huaxia1:{pixelRatio:2,width:24,height:24,x:120,y:482},jinana1:{pixelRatio:2,width:24,height:24,x:144,y:482},lana1:{pixelRatio:2,width:24,height:24,x:168,y:482},lnqingguia1:{pixelRatio:2,width:24,height:24,x:192,y:482},lnqingguit1:{pixelRatio:2,width:24,height:24,x:216,y:482},lva1:{pixelRatio:2,width:24,height:24,x:240,y:482},nanchanga1:{pixelRatio:2,width:24,height:24,x:264,y:482},nanchangt1:{pixelRatio:2,width:24,height:24,x:288,y:482},nanjingdianche1:{pixelRatio:2,width:24,height:24,x:312,y:482},nanninga1:{pixelRatio:2,width:24,height:24,x:336,y:482},nanningt1:{pixelRatio:2,width:24,height:24,x:360,y:482},qingdaoa1:{pixelRatio:2,width:24,height:24,x:384,y:482},qingdaot1:{pixelRatio:2,width:24,height:24,x:408,y:482},shenfa1:{pixelRatio:2,width:24,height:24,x:432,y:482},shenzhen1:{pixelRatio:2,width:24,height:24,x:456,y:482},shijiazhuanga1:{pixelRatio:2,width:24,height:24,x:480,y:482},shijiazhuangt1:{pixelRatio:2,width:24,height:24,x:502,y:305},tianjint1:{pixelRatio:2,width:24,height:24,x:501,y:426},wulumuqit1:{pixelRatio:2,width:24,height:24,x:501,y:454},wuhant1:{pixelRatio:2,width:24,height:24,x:499,y:204},wulumuqia1:{pixelRatio:2,width:24,height:24,x:500,y:333},xiament1:{pixelRatio:2,width:24,height:24,x:479,y:233},xiamena1:{pixelRatio:2,width:24,height:24,x:502,y:362},xuzhoua1:{pixelRatio:2,width:24,height:24,x:486,y:394},xuzhout1:{pixelRatio:2,width:24,height:24,x:497,y:168},zhongxin1:{pixelRatio:2,width:24,height:24,x:501,y:265},chengdut1:{pixelRatio:2,width:28,height:20,x:498,y:0},wenzhout1:{pixelRatio:2,width:24,height:22,x:496,y:56},jiaohang1:{pixelRatio:2,width:22,height:22,x:504,y:482},changshat1:{pixelRatio:2,width:23,height:20,x:503,y:233},xianggangt1:{pixelRatio:2,width:22,height:20,x:490,y:112},nanjingt1:{pixelRatio:2,width:21,height:20,x:0,y:506},taibeit1:{pixelRatio:2,width:21,height:20,x:21,y:506},huaiandianche1:{pixelRatio:2,width:23,height:18,x:42,y:506},beijingt1:{pixelRatio:2,width:20,height:20,x:65,y:506},beijingw1:{pixelRatio:2,width:20,height:20,x:85,y:506},beijingy1:{pixelRatio:2,width:20,height:20,x:105,y:506},changchunt1:{pixelRatio:2,width:20,height:20,x:125,y:506},changzhouw:{pixelRatio:2,width:20,height:20,x:145,y:506},chongqingt1:{pixelRatio:2,width:20,height:20,x:165,y:506},daliant1:{pixelRatio:2,width:20,height:20,x:185,y:506},dongguanw1:{pixelRatio:2,width:20,height:20,x:205,y:506},fuzhouw1:{pixelRatio:2,width:20,height:20,x:225,y:506},guangzhout1:{pixelRatio:2,width:20,height:20,x:245,y:506},guiyangw1:{pixelRatio:2,width:20,height:20,x:265,y:506},haerbint1:{pixelRatio:2,width:20,height:20,x:285,y:506},hangzhout1:{pixelRatio:2,width:20,height:20,x:305,y:506},hefeiw1:{pixelRatio:2,width:20,height:20,x:325,y:506},hongw1:{pixelRatio:2,width:20,height:20,x:345,y:506},jinanw1:{pixelRatio:2,width:20,height:20,x:365,y:506},kunmingt1:{pixelRatio:2,width:20,height:20,x:385,y:506},lanw1:{pixelRatio:2,width:20,height:20,x:405,y:506},lnqingguiw1:{pixelRatio:2,width:20,height:20,x:425,y:506},lvw1:{pixelRatio:2,width:20,height:20,x:445,y:506},minsheng1:{pixelRatio:2,width:20,height:20,x:465,y:506},nanchangw1:{pixelRatio:2,width:20,height:20,x:485,y:506},nanningw1:{pixelRatio:2,width:20,height:20,x:505,y:506},ningbot1:{pixelRatio:2,width:20,height:20,x:525,y:506},qingdaow1:{pixelRatio:2,width:20,height:20,x:526,y:482},qitayinhang1:{pixelRatio:2,width:20,height:20,x:526,y:305},shanghait1:{pixelRatio:2,width:20,height:20,x:525,y:426},shenyangt1:{pixelRatio:2,width:20,height:20,x:525,y:454},shenzhent1:{pixelRatio:2,width:20,height:20,x:523,y:204},shijiazhuangw1:{pixelRatio:2,width:20,height:20,x:524,y:333},wulumuqiw1:{pixelRatio:2,width:20,height:20,x:526,y:233},wuxit1:{pixelRatio:2,width:20,height:20,x:526,y:362},xiant1:{pixelRatio:2,width:20,height:20,x:510,y:394},zhengzhout1:{pixelRatio:2,width:20,height:20,x:521,y:168},xiamenw1:{pixelRatio:2,width:20,height:20,x:525,y:265},xuzhouw1:{pixelRatio:2,width:20,height:20,x:526,y:0},guangda1:{pixelRatio:2,width:24,height:16,x:520,y:56},pufa1:{pixelRatio:2,width:24,height:16,x:512,y:112},xingye1:{pixelRatio:2,width:24,height:16,x:0,y:526},suzhoudianche1:{pixelRatio:2,width:24,height:11,x:24,y:526},arrowRight:{pixelRatio:2,width:23,height:11,x:48,y:526},arrowLeft:{pixelRatio:2,width:23,height:7,x:71,y:526},daodian1:{pixelRatio:2,width:8,height:8,x:94,y:526}},v=(R.prototype._initEvent=function(){this._context.on("pick-start",this._pickStart,this)},R.prototype._pickStart=function(t){var e;0!==this._lngLats.length&&(e=t.uuid,t=t.type,e===this._id&&this._context.fire("picked:"+t,{type:t,feature:this}))},R.prototype.getId=function(){return this._id},R.prototype.project=function(t){var e=this,i=!0;Array.isArray(t)||(i=!(t=[t]));t=t.map(function(t){return e._context._shapeConfig.lngLatsToPoints(t)});return i?t:0===t.length?null:t[0]},R.prototype.clone=function(t){return(t=!Array.isArray(t)?[t]:t).map(function(t){return x({},t)})},R.prototype.add=function(){},R.prototype.delete=function(){},R.prototype.update=function(){},R.prototype.getLngLats=function(){return this.clone(this._lngLats)},R.prototype.setLngLats=function(t){Array.isArray(t)||(t=[t]),this._lngLats=this.clone(t),this.repaint()},R.prototype.setStyle=function(t,e){void 0===e&&(e=!0),this.style=x(x({},this.style),t),e&&this._context.fire("repaint")},R.prototype.setId=function(t){var e,i,n;-1!==this._id.indexOf("id_")&&(e=this._id,n="_",2<(i=this._id.split("_")).length?n+=i.slice(2).join("_"):n="",this._id=""+t+n,this._context.color.changeUuid(e,this._id))},R.prototype.destroy=function(){this._lngLats=[],this._context.off("pick-start",this._pickStart,this)},R);function R(t,e,i){void 0===i&&(i={}),this._context=t;var n,t=(e=x(x({},i),e)).id,i=void 0===t?"0":t,t=e.lngLats,t=void 0===t?[]:t,e=e.style,e=void 0===e?{}:e;this._id="0"===i?(n=(new Date).getTime(),window.performance&&"function"==typeof window.performance.now&&(n+=performance.now()),"id_xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=(n+16*Math.random())%16|0;return n=Math.floor(n/16),("x"==t?e:3&e|8).toString(16)})):i,this._lngLats=this.clone(t),this._pickColor=this._context.color.getColor(this._id),this.style=e}var L,B={id:"0",lngLats:[],style:{code:0,color:[0,0,0,0]}},t=(l(E,L=v),E.prototype._initDraw=function(){var t=this._context._regl;this.texture=t.texture({width:512,height:128,data:this._context._texture}),this.positionBuffer=t.buffer({usage:"dynamic",type:"float"}),this.texCoordBuffer=t.buffer({usage:"dynamic",type:"float"}),this.elements=t.elements({primitive:"triangles",usage:"dynamic",type:"uint16",count:0,length:0})},E.prototype.waiting=function(t){var i=this;t(function(t,e){i._context.enter(u.EDITING),i._lngLats=[t],e(),i._context.fire("repaint"),i._context.fire("draw-finish",i)},function(t){})},E.prototype.repaint=function(){if(!(this._lngLats.length<1)){for(var t=this.project(this._lngLats),e=this.style.code,e=_[void 0===e?"0":e],i=e.width,n=e.height,o=e.x,r=e.y,h=window.devicePixelRatio,a=i/2,s=[],l=t[0],u=0;u<4;u++){var p=l[0]+-1*Math.pow(-1,u%2)*(a/h),c=l[1]+(Math.floor(u/2)-1)*(n/h);s.push(p,c)}this.positionBuffer(s);for(var x=[],f=0;f<4;f++){var g=o+i*(f%2),d=r+n*Math.floor(f/2);x.push(g/512,d/128)}this.texCoordBuffer(x);this.elements([0,1,2,2,1,3])}},E.prototype.select=function(){},E.prototype.unselect=function(){},E);function E(t,e){void 0===e&&(e=B);e=L.call(this,t,e,B)||this;return e.featureType="point",e._initDraw(),e._initEvent(),e}var C,D=(l(Q,C=v),Q.prototype._initDraw=function(){this.positionBuffer=this._context._regl.buffer({usage:"dynamic",type:"float"})},Q.prototype.waiting=function(){},Q.prototype.repaint=function(){if(!(this._lngLats.length<1)){for(var t=this.project(this._lngLats),e=[],i=0;i<t.length;i++){var n=t[i];e.push.apply(e,n)}this.positionBuffer(e)}},Q.prototype.unselect=function(){},Q.prototype.select=function(){},Q);function Q(t,e){t=C.call(this,t,e,{})||this;return t.attachIds=[],t.featureType="node",t.attachIds.push(e.attachId),t._initDraw(),t._initEvent(),t}var k,b={id:"0",lngLats:[],style:{width:3,color:[255,0,0,255]}},I=(l(z,k=v),z.prototype._initDraw=function(){var t=this._context._regl;this.positionBuffer=t.buffer({usage:"dynamic",type:"float"}),this.offsetBuffer=t.buffer({usage:"dynamic",type:"float"}),this.elements=t.elements({primitive:"triangles",usage:"dynamic",type:"uint16",count:0,length:0})},z.prototype.waiting=function(t){var a=this;t(function(t,e){a._context.enter(u.EDITING);var i=a._lngLats.length;if(1<i){var n=a._lngLats[i-2],o=a.project(n),r=a.project(t),n=Math.abs(o[0]-r[0]),r=Math.abs(o[1]-r[1]);if(n<=a._context.pixDis&&r<=a._context.pixDis)return a._lngLats.splice(i-1,1),a.nodes.splice(i-1,1),a.nodes[a.nodes.length-1].style.size=18,e(),void a._context.fire("draw-finish",a);a._lngLats[i-1]=t,a.nodes[i-1].setLngLats(t)}else{a._lngLats.push(t);var h=a._lngLats.length-1;a.createNode(t,h)}a._lngLats.push(t);h=a._lngLats.length-1;a.createNode(t,h)},function(t){var e=a._lngLats.length;0!==e&&(a._lngLats[e-1]=t,a.nodes[e-1].setLngLats(t))})},z.prototype.createNode=function(t,e){t=new D(this._context,{id:this._id+"_node_"+e,attachId:this._id,lngLats:[t],style:{color:[255,255,255,255],size:14}});return this.nodes.push(t),t},z.prototype.nodeRestyle=function(){var i=this.nodes.length-1;this.nodes.forEach(function(t,e){e=0!==e&&e!==i?14:18;t.setStyle({size:e},!1)})},z.prototype.repaint=function(){if(!(this._lngLats.length<2||2===this._lngLats.length&&this._lngLats[0]===this._lngLats[1])){for(var t=this.project(this._lngLats),e=t.length,i=[],n=0;n<t.length;n++){var o=t[n];i.push.apply(i,o)}s.pushElement(i,e-1,2),s.unshiftElement(i,0,2);var r=new Float32Array(s.duplicate(i,2)),h=new Array(e).fill(1),h=s.duplicate(h,1,-1),e=a.lineMesh([],e,0);this.positionBuffer(r),this.offsetBuffer(h),this.elements(e),this.nodeRestyle()}},z.prototype.unselect=function(){var t,e,i=this;this.nodes.length<2||(this.nodesDestroy(),t=this._lngLats[0],e=this._lngLats[this._lngLats.length-1],this.nodes=[t,e].map(function(t,e){e=i.createNode(t,e);return e.setStyle({size:18},!1),e}),this._context.fire("repaint"))},z.prototype.select=function(){var i=this;this.nodesDestroy(),this._lngLats.forEach(function(t,e){t=i.createNode(t,e);0!==e&&e!==i._lngLats.length-1||t.setStyle({size:18},!1)}),this._context.fire("repaint")},z.prototype.nodesDestroy=function(){this.nodes.forEach(function(t){t.destroy()}),this.nodes=[]},z.prototype.destroy=function(){this.nodesDestroy(),k.prototype.destroy.call(this)},z);function z(t,e){void 0===e&&(e=b);e=k.call(this,t,e,b)||this;return e.nodes=[],e.featureType="line",e._initDraw(),e._initEvent(),e}var j=P,e=P;function P(t,e,i){i=i||2;var n,o,r,h,a,s=e&&e.length,l=s?e[0]*i:t.length,u=O(t,0,l,i,!0),p=[];if(!u||u.next===u.prev)return p;if(s&&(u=function(t,e,i,n){var o,r,h,a,s=[];for(o=0,r=e.length;o<r;o++)h=e[o]*n,a=o<r-1?e[o+1]*n:t.length,(a=O(t,h,a,n,!1))===a.next&&(a.steiner=!0),s.push(function(t){var e=t,i=t;for(;(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next,e!==t;);return i}(a));for(s.sort(M),o=0;o<s.length;o++)!function(t,e){(e=function(t,e){var i,n=e,o=t.x,r=t.y,h=-1/0;do{if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){var a=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=o&&h<a){if((h=a)===o){if(r===n.y)return n;if(r===n.next.y)return n.next}i=n.x<n.next.x?n:n.next}}}while(n=n.next,n!==e);if(!i)return null;if(o===h)return i;var s,l=i,u=i.x,p=i.y,c=1/0;n=i;for(;o>=n.x&&n.x>=u&&o!==n.x&&S(r<p?o:h,r,u,p,r<p?h:o,r,n.x,n.y)&&(s=Math.abs(r-n.y)/(o-n.x),H(n,t)&&(s<c||s===c&&(n.x>i.x||n.x===i.x&&function(t,e){return T(t.prev,t,e.prev)<0&&T(e.next,t,t.next)<0}(i,n)))&&(i=n,c=s)),n=n.next,n!==l;);return i}(t,e))&&(t=Y(e,t),F(e,e.next),F(t,t.next))}(s[o],i),i=F(i,i.next);return i}(t,e,u,i)),t.length>80*i){for(var c=n=t[0],x=o=t[1],f=i;f<l;f+=i)(r=t[f])<c&&(c=r),(h=t[f+1])<x&&(x=h),n<r&&(n=r),o<h&&(o=h);a=0!==(a=Math.max(n-c,o-x))?1/a:0}return Z(u,p,i,c,x,a),p}function O(t,e,i,n,o){var r,h;if(o===0<q(t,e,i,n))for(r=e;r<i;r+=n)h=J(r,t[r],t[r+1],h);else for(r=i-n;e<=r;r-=n)h=J(r,t[r],t[r+1],h);return h&&U(h,h.next)&&(X(h),h=h.next),h}function F(t,e){if(!t)return t;e=e||t;var i,n=t;do{if(i=!1,n.steiner||!U(n,n.next)&&0!==T(n.prev,n,n.next))n=n.next;else{if(X(n),(n=e=n.prev)===n.next)break;i=!0}}while(i||n!==e);return e}function Z(t,e,i,n,o,r,h){if(t){!h&&r&&function(t,e,i,n){for(var o=t;null===o.z&&(o.z=N(o.x,o.y,e,i,n)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next,o!==t;);o.prevZ.nextZ=null,o.prevZ=null,function(t){var e,i,n,o,r,h,a,s,l=1;do{for(i=t,r=t=null,h=0;i;){for(h++,n=i,e=a=0;e<l&&(a++,n=n.nextZ);e++);for(s=l;0<a||0<s&&n;)0!==a&&(0===s||!n||i.z<=n.z)?(i=(o=i).nextZ,a--):(n=(o=n).nextZ,s--),r?r.nextZ=o:t=o,o.prevZ=r,r=o;i=n}}while(r.nextZ=null,l*=2,1<h)}(o)}(t,n,o,r);for(var a,s,l=t;t.prev!==t.next;)if(a=t.prev,s=t.next,r?function(t,e,i,n){var o=t.prev,r=t,h=t.next;if(0<=T(o,r,h))return!1;var a=(o.x<r.x?o.x<h.x?o:h:r.x<h.x?r:h).x,s=(o.y<r.y?o.y<h.y?o:h:r.y<h.y?r:h).y,l=(o.x>r.x?o.x>h.x?o:h:r.x>h.x?r:h).x,u=(o.y>r.y?o.y>h.y?o:h:r.y>h.y?r:h).y,p=N(a,s,e,i,n),c=N(l,u,e,i,n),x=t.prevZ,f=t.nextZ;for(;x&&x.z>=p&&f&&f.z<=c;){if(x!==t.prev&&x!==t.next&&S(o.x,o.y,r.x,r.y,h.x,h.y,x.x,x.y)&&0<=T(x.prev,x,x.next))return!1;if(x=x.prevZ,f!==t.prev&&f!==t.next&&S(o.x,o.y,r.x,r.y,h.x,h.y,f.x,f.y)&&0<=T(f.prev,f,f.next))return!1;f=f.nextZ}for(;x&&x.z>=p;){if(x!==t.prev&&x!==t.next&&S(o.x,o.y,r.x,r.y,h.x,h.y,x.x,x.y)&&0<=T(x.prev,x,x.next))return!1;x=x.prevZ}for(;f&&f.z<=c;){if(f!==t.prev&&f!==t.next&&S(o.x,o.y,r.x,r.y,h.x,h.y,f.x,f.y)&&0<=T(f.prev,f,f.next))return!1;f=f.nextZ}return!0}(t,n,o,r):function(t){var e=t.prev,i=t,n=t.next;if(0<=T(e,i,n))return!1;var o=t.next.next;for(;o!==t.prev;){if(S(e.x,e.y,i.x,i.y,n.x,n.y,o.x,o.y)&&0<=T(o.prev,o,o.next))return!1;o=o.next}return!0}(t))e.push(a.i/i),e.push(t.i/i),e.push(s.i/i),X(t),t=s.next,l=s.next;else if((t=s)===l){h?1===h?Z(t=function(t,e,i){var n=t;do{var o=n.prev,r=n.next.next}while(!U(o,r)&&G(o,n,n.next,r)&&H(o,r)&&H(r,o)&&(e.push(o.i/i),e.push(n.i/i),e.push(r.i/i),X(n),X(n.next),n=t=r),n=n.next,n!==t);return F(n)}(F(t),e,i),e,i,n,o,r,2):2===h&&function(t,e,i,n,o,r){var h=t;do{for(var a=h.next.next;a!==h.prev;){if(h.i!==a.i&&function(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&G(i,i.next,t,e))return!0}while(i=i.next,i!==t);return!1}(t,e)&&(H(t,e)&&H(e,t)&&function(t,e){var i=t,n=!1,o=(t.x+e.x)/2,r=(t.y+e.y)/2;for(;i.y>r!=i.next.y>r&&i.next.y!==i.y&&o<(i.next.x-i.x)*(r-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next,i!==t;);return n}(t,e)&&(T(t.prev,t,e.prev)||T(t,e.prev,e))||U(t,e)&&0<T(t.prev,t,t.next)&&0<T(e.prev,e,e.next))}(h,a)){var s=Y(h,a);return h=F(h,h.next),s=F(s,s.next),Z(h,e,i,n,o,r),Z(s,e,i,n,o,r)}a=a.next}}while((h=h.next)!==t)}(t,e,i,n,o,r):Z(F(t),e,i,n,o,r,1);break}}}function M(t,e){return t.x-e.x}function N(t,e,i,n,o){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*o)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*o)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function S(t,e,i,n,o,r,h,a){return 0<=(o-h)*(e-a)-(t-h)*(r-a)&&0<=(t-h)*(n-a)-(i-h)*(e-a)&&0<=(i-h)*(r-a)-(o-h)*(n-a)}function T(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function U(t,e){return t.x===e.x&&t.y===e.y}function G(t,e,i,n){var o=V(T(t,e,i)),r=V(T(t,e,n)),h=V(T(i,n,t)),a=V(T(i,n,e));return o!==r&&h!==a||(0===o&&W(t,i,e)||(0===r&&W(t,n,e)||(0===h&&W(i,t,n)||!(0!==a||!W(i,e,n)))))}function W(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function V(t){return 0<t?1:t<0?-1:0}function H(t,e){return T(t.prev,t,t.next)<0?0<=T(t,e,t.next)&&0<=T(t,t.prev,e):T(t,e,t.prev)<0||T(t,t.next,e)<0}function Y(t,e){var i=new K(t.i,t.x,t.y),n=new K(e.i,e.x,e.y),o=t.next,r=e.prev;return(t.next=e).prev=t,(i.next=o).prev=i,(n.next=i).prev=n,(r.next=n).prev=r,n}function J(t,e,i,n){i=new K(t,e,i);return n?(i.next=n.next,(i.prev=n).next.prev=i,n.next=i):(i.prev=i).next=i,i}function X(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function K(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function q(t,e,i,n){for(var o=0,r=e,h=i-n;r<i;r+=n)o+=(t[h]-t[r])*(t[r+1]+t[h+1]),h=r;return o}P.deviation=function(t,e,i,n){var o=e&&e.length,r=o?e[0]*i:t.length,h=Math.abs(q(t,0,r,i));if(o)for(var a=0,s=e.length;a<s;a++){var l=e[a]*i,u=a<s-1?e[a+1]*i:t.length;h-=Math.abs(q(t,l,u,i))}for(var p=0,a=0;a<n.length;a+=3){var c=n[a]*i,x=n[a+1]*i,f=n[a+2]*i;p+=Math.abs((t[c]-t[f])*(t[1+x]-t[1+c])-(t[c]-t[x])*(t[1+f]-t[1+c]))}return 0===h&&0===p?0:Math.abs((p-h)/h)},P.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},n=0,o=0;o<t.length;o++){for(var r=0;r<t[o].length;r++)for(var h=0;h<e;h++)i.vertices.push(t[o][r][h]);0<o&&(n+=t[o-1].length,i.holes.push(n))}return i},j.default=e;var $,tt={id:"0",lngLats:[],style:{color:[255,0,0,120]}},e=(l(et,$=v),et.prototype._initDraw=function(){var t=this._context._regl;this.positionBuffer=t.buffer({usage:"dynamic",type:"float"}),this.elements=t.elements({primitive:"triangles",usage:"dynamic",type:"uint16",count:0,length:0})},et.prototype.waiting=function(t){var h=this;t(function(t,e){h._context.enter(u.EDITING);var i=h._lngLats.length;if(1<i){var n=h._lngLats[i-3],o=h.project(n),r=h.project(t),n=Math.abs(o[0]-r[0]),r=Math.abs(o[1]-r[1]);if(n<=h._context.pixDis&&r<=h._context.pixDis)return h._lngLats.splice(i-2,1),h._line.setLngLats(h._lngLats),e(),void h._context.fire("draw-finish",h)}else h._lngLats.push(t),h._lngLats.push(t);i=h._lngLats.length,h._lngLats.splice(i-2,0,t),h._line.setLngLats(h._lngLats)},function(t){var e=h._lngLats.length;0!==e&&(h._lngLats[e-2]=t,h._line.setLngLats(h._lngLats))})},et.prototype.repaint=function(){if(!(this._lngLats.length<2||3===this._lngLats.length&&this._lngLats[0]===this._lngLats[1]&&this._lngLats[1]===this._lngLats[2])){for(var t=this.project(this._lngLats),e=[],i=0;i<t.length;i++){var n=t[i];e.push.apply(e,n)}var o=j(e);0===o.length&&(o=[0,1,2]),this.positionBuffer(e),this.elements(o)}},et.prototype.unselect=function(){},et.prototype.select=function(){},et.prototype.destroy=function(){$.prototype.destroy.call(this),this._line&&this._line.destroy()},et);function et(t,e){void 0===e&&(e=tt);var i=$.call(this,t,e,tt)||this;i.featureType="polygon";e=i._id+"_border";return i._line=new I(t,{id:e,lngLats:i._lngLats,style:{width:2,color:i.style.color}}),i._initEvent(),i._initDraw(),i}var it="#define GLSLIFY 1\nuniform mat3 model;uniform float thickness;uniform int miter;uniform float aspect;uniform float height;attribute vec2 prevPosition;attribute vec2 currPosition;attribute vec2 nextPosition;attribute float offsetScale;void main(){vec2 aspectVec=vec2(aspect,1.0);vec2 prevProject=(model*vec3(prevPosition,1.0)).xy;vec2 currProject=(model*vec3(currPosition,1.0)).xy;vec2 nextProject=(model*vec3(nextPosition,1.0)).xy;vec2 prevScreen=prevProject*aspectVec;vec2 currScreen=currProject*aspectVec;vec2 nextScreen=nextProject*aspectVec;float len=thickness;vec2 dir=vec2(0.0);if(currScreen==prevScreen){dir=normalize(nextScreen-currScreen);}else if(currScreen==nextScreen){dir=normalize(currScreen-prevScreen);}else{vec2 dirA=normalize((currScreen-prevScreen));if(miter==1){vec2 dirB=normalize((nextScreen-currScreen));float cosin=dot(dirA,dirB);if(cosin<-0.995){dir=dirB;}else{vec2 tangent=normalize(dirA+dirB);vec2 perp=vec2(-dirA.y,dirA.x);vec2 miter=vec2(-tangent.y,tangent.x);dir=tangent;len=thickness/dot(miter,perp);}}else{dir=dirA;}}vec2 normal=vec2(-dir.y,dir.x)*len;normal.y/=height;normal.x/=height*aspect/2.0;normal.x/=aspect;vec4 offset=vec4(normal*offsetScale,0.0,0.0);gl_Position=vec4(currProject,0.0,1.0)+offset;}",nt="precision mediump float;\n#define GLSLIFY 1\nuniform vec4 color;void main(){gl_FragColor=color/255.0;}",ot=((v={})[y.POLYGON]=e,v[y.BORDER]=I,v[y.LINE]=I,v[y.NODE]=D,v[y.POINT]=t,v),rt=Float32Array.BYTES_PER_ELEMENT,ht=(at.prototype._init=function(){var e=this;Object.values(y).forEach(function(t){e._features[t]=[],e._featureProps[t]=[],e._fboFeatureProps[t]=[]}),this._newFeature=null},at.prototype._initializeEvent=function(){var e=this;this._context.on("repaint",this.repaint,this),this._context.on("draw-finish",this._drawFinish,this),this._context.on("picked:click",this._pickedClick,this),this._context.on("picked:mousemove",this._pickedHover,this),this._context.on("picked:mouseout",this._pickedOut,this),this._context.on("picked:clickout",this._pickedClickout,this),this._context._gl.canvas.addEventListener("click",this.pickEvent.bind(this)),this._context._gl.canvas.addEventListener("mousemove",function(t){e._pickTick&&clearTimeout(e._pickTick),e._pickTick=setTimeout(function(){e.pickEvent(t),e._pickTick=null},60)}),function(t,e){const i=new Image;i.src=t,i.onload=function(){e(i)}}("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAACACAMAAABKiSE5AAADJmlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxMTEgNzkuMTU4MzI1LCAyMDE1LzA5LzEwLTAxOjEwOjIwICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxNSAoV2luZG93cykiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NkRCMEZBMTA4Qjc3MTFFQjhBM0JGMkFBMDI0ODQyOEMiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6NkRCMEZBMTE4Qjc3MTFFQjhBM0JGMkFBMDI0ODQyOEMiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo2REIwRkEwRThCNzcxMUVCOEEzQkYyQUEwMjQ4NDI4QyIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo2REIwRkEwRjhCNzcxMUVCOEEzQkYyQUEwMjQ4NDI4QyIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PrB+ZBgAAAAZdEVYdFNvZnR3YXJlAEFkb2JlIEltYWdlUmVhZHlxyWU8AAACZ1BMVEVHcEzy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",function(t){e._context._texture=t,e._context.fire("textured")})},at.prototype.pickEvent=function(t){var i,n,o,r=this,e=t.clientX,h=t.clientY,a=t.type,s=this._context,l=s._regl,t=s.mapStatus,s=s.mode;(s!==u.WATING&&s!==u.EDITING||"click"!==a)&&("movestart"!==t||"click"!==a?(s=window.devicePixelRatio,t=this._mapContainer.getBoundingClientRect(),i=s*(e-t.left),n=l._gl.drawingBufferHeight-s*(h-t.top),i<0||i>=l._gl.drawingBufferWidth||n<0||n>=l._gl.drawingBufferHeight||(o=l.framebuffer({width:l._gl.drawingBufferWidth,height:l._gl.drawingBufferHeight,depth:!1,stencil:!1,depthStencil:!1}),l({framebuffer:o})(function(){r.repaint({fbo:!0,drawing:!1});var t=new Float32Array([0,0,0,0]);try{t=l.read({x:i,y:n,width:1,height:1})}catch(t){console.log(t)}o.destroy();var e=t.join("-"),e=r._context.color.getUUID(e);e?r._context.fire("pick-start",{uuid:e,type:a}):"mousemove"===a?r._context.fire("picked:mouseout"):"click"===a&&r._context.fire("picked:clickout")}))):this._context.setMapStatus(""))},at.prototype._pickedHover=function(t){t=t.feature;this._context.hover(t.featureType,!0)},at.prototype._pickedOut=function(){this._context.out()},at.prototype._pickedClick=function(t){var e=t.feature;this._pickedClickout();t=e.featureType.toUpperCase();this._context.enter(u[t+"_SELECT"]),this._pickedFeature=e,this._pickedFeature.select()},at.prototype._pickedClickout=function(){0==~this._context.mode.indexOf("_select")&&this._context.mode!==u.IDLE||this._pickedFeature&&(this._pickedFeature.unselect(),this._pickedFeature=null)},at.prototype._initializeDrawCommand=function(){this.createPolygonDrawCommand(),this.createLineDrawCommand(),this.creatNodeDrawCommand(),this.createPointDrawCommand()},at.prototype.createPointDrawCommand=function(){var t=this._context._regl,e={model:t.prop("modelMatrix"),texture:t.prop("texture"),color:t.prop("color"),fbo:t.prop("fbo")},i={aPosition:{buffer:t.prop("positionBuffer")},aTexCoord:{buffer:t.prop("texCoordBuffer")}};this._drawCommand[y.POINT]=t({vert:"#define GLSLIFY 1\nuniform mat3 model;attribute vec2 aPosition;attribute vec2 aTexCoord;varying vec2 uv;void main(){vec3 position=model*vec3(aPosition,1.0);gl_Position=vec4(position.xy,0.0,1.0);uv=aTexCoord;}",frag:"precision mediump float;\n#define GLSLIFY 1\nuniform sampler2D texture;uniform bool fbo;uniform vec4 color;varying vec2 uv;void main(){if(fbo){gl_FragColor=color/255.0;}else{gl_FragColor=texture2D(texture,uv);}}",uniforms:e,attributes:i,elements:t.prop("elements")})},at.prototype.createLineDrawCommand=function(){var t=this._context._regl,e={model:t.prop("modelMatrix"),color:t.prop("color")||[255,255,255,255],thickness:t.prop("width")||3,miter:1,aspect:function(t){return t.viewportWidth/t.viewportHeight},height:function(t){return t.viewportHeight/t.pixelRatio}},i={prevPosition:{buffer:t.prop("positionBuffer"),offset:0},currPosition:{buffer:t.prop("positionBuffer"),offset:2*rt*2},nextPosition:{buffer:t.prop("positionBuffer"),offset:2*rt*4},offsetScale:t.prop("offsetBuffer")};this._drawCommand[y.LINE]=t({vert:it,frag:nt,uniforms:e,attributes:i,elements:t.prop("elements")}),this._drawCommand[y.BORDER]=t({vert:it,frag:nt,uniforms:e,attributes:i,elements:t.prop("elements")})},at.prototype.createPolygonDrawCommand=function(){var t=this._context._regl,e={model:t.prop("modelMatrix"),color:t.prop("color")||[255,0,102,127]},i={aPosition:{buffer:t.prop("positionBuffer"),offset:0}};this._drawCommand[y.POLYGON]=t({vert:"#define GLSLIFY 1\nuniform mat3 model;attribute vec2 aPosition;void main(){vec3 position=model*vec3(aPosition,1.0);gl_Position=vec4(position.xy,0.0,1.0);}",frag:"precision mediump float;\n#define GLSLIFY 1\nuniform vec4 color;void main(){gl_FragColor=color/255.0;}",uniforms:e,attributes:i,elements:t.prop("elements")})},at.prototype.creatNodeDrawCommand=function(){var t=this._context._regl,e={model:t.prop("modelMatrix"),color:t.prop("color"),size:t.prop("size")},i={aPosition:{buffer:t.prop("positionBuffer"),offset:0}};this._drawCommand[y.NODE]=t({vert:"#define GLSLIFY 1\nuniform mat3 model;uniform float size;attribute vec2 aPosition;void main(){vec3 position=model*vec3(aPosition,1.0);gl_Position=vec4(position.xy,0.0,1.0);gl_PointSize=size;}",frag:"precision mediump float;\n#define GLSLIFY 1\nuniform vec4 color;void main(){float dist=distance(gl_PointCoord,vec2(0.5,0.5));float smooth1=smoothstep(0.55,0.45,dist);float smooth2=smoothstep(0.45,0.4,dist);gl_FragColor=vec4(0,0,0,1)*smooth1*(1.0-smooth2)+color/255.0*smooth2;}",uniforms:e,attributes:i,primitive:"points",count:1})},at.prototype.render=function(i,t){var r=this;void 0===i&&(i={});var e=[y.POLYGON,y.LINE,y.POINT];e.forEach(function(t){var e=r._features[t];r._features[t]=[];for(var i=0,n=e;i<n.length;i++){var o=n[i];o._id.startsWith("id_")?r._features[t].push(o):o.destroy()}}),e.forEach(function(e){var t=(i[e]||[]).map(function(t){return new ot[e](r._context,t)});r._features[e]=r._features[e].concat(t)}),this.repaint()},at.prototype.start=function(t,e){var i=this;this._pickedClickout(),this._context.enter(u.WATING),this._newFeature&&this._newFeature.destroy(),this._newFeature=new ot[t](this._context,void 0),this._newFeature.waiting(e),t!==y.POINT&&(this._tick=this._context._regl.frame(function(){i.drawing()}))},at.prototype._drawFinish=function(t){this._context.enter(u[t.featureType.toUpperCase()+"_SELECT"]),this._newFeature&&(this._addFeature(this._newFeature),this._pickedFeature=this._newFeature,this._context.fire("finish",this._newFeature),this._clearTick(),this._newFeature=null,this.repaint())},at.prototype.drawBatch=function(t,e,i){var n=this;i?this._drawCommand[t](e):(i=t!==y.LINE,this._context._regl({blend:{enable:i,func:{src:"src alpha",dst:"one minus src alpha"}},depth:{mask:!1}})(function(){n._drawCommand[t](e)}))},at.prototype.repaint=function(t){var e=this;void 0===t&&(t={fbo:!1,drawing:!1});var i,n,o,r,h=this._context._regl;if(h){this._isPoll&&(i=window.devicePixelRatio,n=this._mapContainer.clientWidth,o=this._mapContainer.clientHeight,(r=h._gl.canvas).width=n*i,r.height=o*i,r.style.width=n+"px",r.style.height=o+"px",this._isPoll=!1,h.poll()),h.clear({color:[0,0,0,0],depth:1});var a=t.fbo,s=t.drawing,l=a?this._fboFeatureProps:this._featureProps,u=l[y.NODE],p=l[y.BORDER];s||(u=[],p=[]);for(var c=0,x=[y.POLYGON,y.LINE,y.POINT];c<x.length;c++){var f,g,d=x[c];s||(f=this._features[d].map(function(t){return t.featureType===y.POLYGON&&p.push(e.featureMap(t._line,a)),t.featureType===y.LINE&&t.nodes.forEach(function(t){u.push(e.featureMap(t,a))}),e.featureMap(t,a)}),l[d]=f,d===y.POLYGON&&(l[y.BORDER]=p),d===y.LINE&&(l[y.NODE]=u)),0<(g=l[d]).length&&this.drawBatch(d,g,a),d===y.POLYGON&&0<l[y.BORDER].length&&this.drawBatch(y.BORDER,l[y.BORDER],a),d===y.LINE&&0<l[y.NODE].length&&this.drawBatch(y.NODE,l[y.NODE],a)}this._newFeature&&!a&&(d=this._newFeature.featureType,t=this.featureMap(this._newFeature,a),this.drawBatch(d,t,a),d===y.POLYGON&&(t=this._newFeature._line,t=this.featureMap(t,a),this.drawBatch(y.BORDER,t,a)),d===y.LINE&&(g=this._newFeature.nodes.map(function(t){return e.featureMap(t,a)}),this.drawBatch(y.NODE,g,a)))}},at.prototype.drawing=function(){this.repaint({drawing:!0,fbo:!1})},at.prototype.featureMap=function(t,e){e||t.repaint();var i=t.featureType,n=t.positionBuffer,o=t.offsetBuffer,r=t.texCoordBuffer,h=t.texture,a=t.elements,s=t._pickColor,l=t.style,u=e?s:l.color,s=this._context._shapeConfig.getModelMatrix(),p=x(x({_id:t._id,positionBuffer:n},l),{color:u,modelMatrix:s,elements:a});switch(i){case y.BORDER:case y.LINE:var c=e?20:l.width;return x(x({},p),{width:c,offsetBuffer:o});case y.POLYGON:return p;case y.NODE:c=e?40:l.size;return x(x({},p),{size:c});case y.POINT:return x(x({},p),{texCoordBuffer:r,texture:h,fbo:!!e})}},at.prototype._addFeature=function(t){var e=t.featureType;this._features[e].push(t)},at.prototype.getFeature=function(e){var i=this,n=null;return Object.keys(this._features).forEach(function(t){n=n||i._features[t].find(function(t){return t._id===e})}),n},at.prototype.changeIds=function(t){var n=this;void 0===t&&(t={}),Object.keys(t).forEach(function(e){var i=t[e];Object.keys(n._features).forEach(function(t){t=n._features[t].find(function(t){return-1<t._id.indexOf(e)});t&&t.setId(i)})})},at.prototype.clear=function(){this._init(),this._clearTick(),this.repaint()},at.prototype._clearTick=function(){this._tick&&(this._tick.cancel(),this._tick=null),this._pickTick&&(clearTimeout(this._pickTick),this._pickTick=null)},at);function at(t,e,i){var n;this._features={},this._featureProps={},this._fboFeatureProps={},this._drawCommand=((n={})[y.POLYGON]=null,n[y.BORDER]=null,n[y.LINE]=null,n[y.NODE]=null,n[y.POINT]=null,n),this._pickedFeature=null,this._tick=null,this._pickTick=null,this._context=new A({gl:t,shapeConfig:e}),this._mapContainer=i,this._init(),this._initializeEvent(),this._initializeDrawCommand()}const{Renderer:st,DomEvent:{on:lt,off:ut},Util:{cancelAnimFrame:pt},DomUtil:{remove:ct,setPosition:xt}}=n.default,ft=st.extend({getEvents:function(){var t=st.prototype.getEvents.call(this);return t.moveend=this._update,t.movestart=this._movestart,t},onAdd:function(){st.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var t=this._container=document.createElement("canvas");if(lt(t,"mousemove",this._onMouseMove,this),lt(t,"click dblclick mousedown mouseup contextmenu",this._onClick,this),lt(t,"mouseout",this._onMouseOut,this),this.gl=t.getContext("webgl"),!this.gl)throw new Error("Webgl is not supported in your broswer")},_draw:function(){this._editor=new ht(this.gl,{lngLatsToPoints:this._LngLatsToPointsCall(),getModelMatrix:this._getModelMatrixCall()},this._map.getContainer()),this._editor._context.on("picked:click picked:mousemove",({type:t,feature:e})=>{e?("mousemove"===t&&(t="hover"),this.fire(`picked:${t}`,{feature:e})):console.log("error:",e._id)}),this._editor._context.on("finish",t=>{this.fire("finish",{feature:t})}),this._editor._context.on("textured",t=>{this.fire("load")}),this._map.on("resize",()=>{this._editor._isPoll=!0,this._editor.repaint()})},start:function(t){if(!this._editor)throw new Error("");var{doubleClickZoom:n}=this._map.options;n&&this._map.doubleClickZoom.disable();let o=null,r=null;this._editor.start(t,(e,i)=>{o=t=>{t=t.latlng;e(t,()=>{this._map.off("click",o),this._map.off("mousemove",r),n&&setTimeout(()=>{this._map.doubleClickZoom.enable()},200)})},r=t=>{t=t.latlng;i(t)},this._map.on("click",o),this._map.on("mousemove",r)})},render:function(t,e){if(!this._editor)throw new Error("gl-editor ");this._editor.render(t,e)},getFeature:function(t){this._editor.getFeature(t)},changeIds:function(t){this._editor.changeIds(t)},clear:function(){this._editor.clear()},_update:function(){st.prototype._update.call(this);const t=this._bounds,e=this._container,i=t.getSize(),n=window.devicePixelRatio;xt(e,t.min),e.width=n*i.x,e.height=n*i.y,e.style.width=i.x+"px",e.style.height=i.y+"px",this._editor&&this._editor.repaint()},_LngLatsToPointsCall:function(){return i=t=>{var{x:e,y:t}=this._map.latLngToContainerPoint(n.default.latLng(t.lat,t.lng));return{x:e,y:t}},t=>{var{x:e,y:t}=i(t);return[e,t]};var i},_getModelMatrixCall:function(){return()=>{var t=this._map.getContainer();return[2/t.clientWidth,0,0,0,-2/t.clientHeight,0,-1,1,1]}},_onClick:function(t){},_movestart:function(){this._editor&&this._editor._context.setMapStatus("movestart")},_onMouseMove:function(t){!this._map||this._map.dragging.moving()||this._map._animatingZoom},_onMouseOut:function(t){},_onMouseHover:function(t,e){},_fireEvent:function(t,e,i){this._map._fireDOMEvent(e,i||e.type,t)},_bringToFront:function(t){},_bringToBack:function(t){},_destroyContainer:function(){pt(this._redrawRequest),delete this.gl,ct(this._container),ut(this._container),delete this._container}});return function(){return new ft({padding:0,zoomAnimation:!1})}});
